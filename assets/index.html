<!DOCTYPE html>
<html lang="ar">
<head><!-- ÙÙŠ Ù‚Ø³Ù… head Ø£Ùˆ Ø¨Ø¯Ø§ÙŠØ© body -->
  <audio id="sound-button-click" src="assets/sounds/button-click.mp3" preload="auto"></audio>
  <audio id="sound-shape-pick" src="assets/sounds/shape-pick.mp3" preload="auto"></audio>
  <audio id="sound-line-clear" src="assets/sounds/line-clear.mp3" preload="auto"></audio>
  <audio id="sound-combo-clear" src="assets/sounds/combo-clear.mp3" preload="auto"></audio>
  <audio id="sound-bubble-appear" src="assets/sounds/bubble-appear.mp3" preload="auto"></audio>
  <title>Block Puzzle AI</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>

    
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #eef6fb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      touch-action: manipulation;
      overflow: hidden;
      padding: 10px;
    }
    
    .back-home-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #2196F3;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .back-home-btn:hover {
      background: #2196F3;
      transform: scale(1.1);
    }
    
    .back-home-btn svg {
      stroke: #2196F3;
      transition: all 0.3s ease;
    }
    
    .back-home-btn:hover svg {
      stroke: white;
    }
    
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background: #eef6fb;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .active { display: flex; }
    
    h1, h2 {
      color: #2196f3;
      margin: 10px;
      font-weight: 600;
    }
    
    .btn {
      background: linear-gradient(45deg, #2196f3, #21cbf3);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.2em;
      margin-top: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    
    #scoreboard {
      font-size: 1.2rem;
      margin: 10px;
      font-weight: bold;
      color: #2196F3;
    }
    
    #grid {
      display: grid;
      gap: 2px;
      margin: 10px auto;
      width: 90vmin;
      height: 90vmin;
      max-width: 400px;
      max-height: 400px;
      grid-template-columns: repeat(8, 1fr);
      grid-template-rows: repeat(8, 1fr);
    }
    
    .cell {
      width: 100%;
      height: 100%;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: background 0.3s ease;
    }
    
    .filled { background: #2196f3; }
    .preview { background-color: rgba(33, 150, 243, 0.5); }
    .line-clear-preview { background-color: rgba(76, 175, 80, 0.6) !important; }
    
    #shapes {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px auto;
      width: 100%;
      max-width: 600px;
    }
    
    .shape {
      display: grid;
      grid-template-columns: repeat(4, clamp(20px, 5vmin, 60px));
      grid-template-rows: repeat(4, clamp(20px, 5vmin, 60px));
      gap: 2px;
      cursor: grab;
      touch-action: none;
      padding: 10px;
    }
    
    .block {
      width: 100%;
      height: 100%;
      background: #2196f3;
      border-radius: 4px;
      transition: transform 0.15s ease;
      pointer-events: none;
    }
    
    .floating {
      position: absolute;
      z-index: 999;
      pointer-events: none;
      opacity: 0.95;
      transition: left 0.07s ease, top 0.07s ease;
      transform: none !important;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 2px;
    }
    
    #finalScoreDisplay {
      font-size: 2.5rem;
      color: #4caf50;
      font-weight: bold;
      margin-top: 20px;
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.6s ease;
    }
    
    #finalScoreDisplay.show {
      opacity: 1;
      transform: scale(1.1);
    }
    
    #countdown {
      font-size: 1.1rem;
      margin-top: 10px;
      color: #888;
    }
    
    /* ğŸ‘‡ AI Reaction Container */
    #aiContainer {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 10px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 120px;
    }
    
    #aiInteractiveArea {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin-bottom: 10px;
      position: relative;
      min-height: 100px;
    }
    
    .ai-bubble {
      position: relative;
      width: 80px;
      height: 80px;
      opacity: 0;
      transform: scale(0.5) translateY(20px);
      transition: all 0.4s ease;
      z-index: 10;
      margin-right: 15px;
    }
    
    .ai-bubble.show {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
    
    .bubble-inner {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff22, #00000033);
      border: 2px solid #ffffff55;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: float 4s ease-in-out infinite;
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.1);
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
    
    .bubble-inner img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      animation: avatarPulse 2.8s ease-in-out infinite, avatarBlink 6s ease-in-out infinite;
      transform-origin: center center;
    }
    
    @keyframes avatarPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.2); filter: brightness(1.25); }
    }
    
    @keyframes avatarBlink {
      0%, 96%, 100% { transform: scaleY(1); filter: brightness(1); }
      97% { transform: scaleY(0.1); filter: brightness(0.3); }
      98% { transform: scaleY(1); filter: brightness(1); }
    }
    
    #aiBoard {
  width: 90vmin;
  max-width: 400px;
  min-height: 80px;
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  padding: 10px 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  opacity: 0;
  transform: scaleX(0);
  transition: all 0.4s ease;
  overflow: hidden;
}
    
    #aiBoard.show {
      transform: scaleX(1);
      opacity: 1;
    }
    
    #aiText {
  font-size: 1.2rem;
  font-weight: 600;
  color: #2196f3;
  text-align: center;
  line-height: 1.4;
  padding: 0 10px;
  word-break: break-word;
  max-width: 100%;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.5s ease;
  margin: 0;
}

    
    #aiText.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    #aiHeatBar {
      width: 100%;
      height: 8px;
      background: linear-gradient(to right, #ff5722, #ffc107);
      border-radius: 6px;
      margin-top: 10px;
      transform: scaleX(0);
      transform-origin: left;
      opacity: 0;
      transition: transform 3s linear, opacity 0.5s ease;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    
    #aiHeatBar.active {
      transform: scaleX(1);
      opacity: 1;
    }
    
    @keyframes bubbleEnter {
      0% { opacity: 0; transform: scale(0.2) rotate(0deg); filter: blur(4px); }
      20% { opacity: 1; transform: scale(1.05) rotate(2deg); }
      40% { transform: scale(0.95) rotate(-2deg); }
      60% { transform: scale(1.02) rotate(1deg); }
      80% { transform: scale(0.98) rotate(-1deg); }
      100% { transform: scale(1) rotate(0deg); filter: blur(0); }
    }
    
    @keyframes bubbleExit {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.5) rotate(-10deg); filter: blur(3px); }
    }
    
    .ai-bubble.show {
      animation: bubbleEnter 0.4s ease-out forwards;
    }
    
    .ai-bubble.hide {
      animation: bubbleExit 0.4s ease-in forwards;
    }
    
    @keyframes boardEnter {
      0% { transform: translateX(-100%) scaleX(0); opacity: 0; }
      60% { transform: translateX(20%) scaleX(1.1); opacity: 1; }
      100% { transform: translateX(0) scaleX(1); opacity: 1; }
    }
    
    @keyframes boardExit {
      0% { transform: translateX(0) scaleX(1); opacity: 1; }
      100% { transform: translateX(-100%) scaleX(0); opacity: 0; }
    }
    
    #aiBoard.show {
      animation: boardEnter 0.5s ease-out forwards;
    }
    
    #aiBoard.hide {
      animation: boardExit 0.5s ease-in forwards;
    }
    
    .welcome-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #eef6fb;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 1000;
    }
    
    .welcome-card {
  background: linear-gradient(to bottom, #ffffff, #f3faff);
  padding: 30px 25px;
  border-radius: 24px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  text-align: center;
  max-width: 380px;
  width: 90%;
  animation: fadeInCard 0.5s ease-out;
}

@keyframes fadeInCard {
  0% { opacity: 0; transform: translateY(20px); }
  100% { opacity: 1; transform: translateY(0); }
}


    .welcome-card p {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }
    
    .welcome-card .btn {
      margin: 8px;
    }
    
    .game-title {
      font-size: 3.5rem;
      color: #2196F3;
      margin: 0 0 30px 0;
      font-weight: 800;
      text-shadow: 0 3px 6px rgba(0,0,0,0.1);
      animation: pulse 2s infinite;
      display: inline-block;
      padding: 0 20px;
      text-align: center;
      width: 100%;
      box-sizing: border-box;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.03); }
      100% { transform: scale(1); }
    }
    
    #menu {
      overflow: hidden;
      padding: 0 15px;
      justify-content: center;
    }
    
    .menu-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      margin-top: -50px;
    }
    
    .start-btn {
      padding: 15px 40px;
      font-size: 1.5rem;
      margin: 10px 0;
    }
    
    .stats-btn {
      background: rgba(33, 150, 243, 0.1);
      color: #2196F3;
      margin: 10px 0 30px 0;
    }
    
    .copyright {
      font-size: 0.8rem; 
      color: #777;
      margin-top: 40px;
      position: absolute;
      bottom: 20px;
    }
    
    .hidden {
      display: none !important;
    }
    
    #aiFlash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
      transition: opacity 0.2s ease;
    }
    
/* Ø§Ù„Ù†Ù‚Ø§Ø· */
.ai-dots {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 3px;
  margin-top: 6px;
  animation: curveDots 2s infinite ease-in-out;
}

@keyframes curveDots {
  0% { transform: translateX(-50%) translateY(0) rotate(0deg); }
  50% { transform: translateX(-50%) translateY(3px) rotate(25deg); }
  100% { transform: translateX(-50%) translateY(0) rotate(0deg); }
}

.ai-dots span {
  width: 6px;
  height: 6px;
  background: white;
  border-radius: 50%;
  opacity: 0.6;
  animation: dotFlash 1s infinite alternate;
}

.ai-dots span:nth-child(2) { animation-delay: 0.2s; }
.ai-dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes dotFlash {
  0% { transform: scale(1); opacity: 0.4; }
  100% { transform: scale(1.3); opacity: 1; }
}

/* Avatar blinking effect */
#aiAvatar.blink {
  opacity: 0.3;
  transition: opacity 0.2s;
}

@keyframes mockShake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}

#aiBubble.mocking {
  animation: mockShake 0.6s ease;
}

@keyframes shakeButton {
  0% { transform: translate(0, 0); }
  20% { transform: translate(-3px, 0); }
  40% { transform: translate(3px, 0); }
  60% { transform: translate(-3px, 0); }
  80% { transform: translate(3px, 0); }
  100% { transform: translate(0, 0); }
}

.shaky {
  animation: shakeButton 0.6s infinite;
}

@keyframes pulseGlow {
  0% { box-shadow: 0 0 10px #21cbf3, 0 0 20px #21cbf3; transform: scale(1); }
  50% { box-shadow: 0 0 20px #00ff99, 0 0 30px #00ff99; transform: scale(1.05); }
  100% { box-shadow: 0 0 10px #21cbf3, 0 0 20px #21cbf3; transform: scale(1); }
}

@keyframes colorShift {
  0% { background: linear-gradient(45deg, #2196f3, #21cbf3); }
  50% { background: linear-gradient(45deg, #00e676, #00c853); }
  100% { background: linear-gradient(45deg, #2196f3, #21cbf3); }
}

.power-btn {
  animation: pulseGlow 2s infinite, colorShift 5s infinite;
}

@keyframes countdownColor {
  0% { color: #00c853; }
  50% { color: #ffc107; }
  100% { color: #f44336; }
}

.countdown-animate {
  animation: countdownColor 5s linear forwards;
}

@keyframes scoreBounce {
  0% { transform: scale(0.5); opacity: 0; }
  60% { transform: scale(1.2); opacity: 1; }
  80% { transform: scale(0.9); }
  100% { transform: scale(1); }
}

.bounce-in {
  animation: scoreBounce 1s ease forwards;
}

.golden-btn {
  background: linear-gradient(45deg, #ffd700, #ffb300);
  color: #fff8dc;
  border: none;
  padding: 15px 30px;
  font-size: 1.4rem;
  font-weight: bold;
  border-radius: 16px;
  cursor: pointer;
  box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
  animation: goldenPulse 2s infinite alternate;
  transition: all 0.3s ease;
}

.golden-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
}

@keyframes goldenPulse {
  0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.6); }
  100% { box-shadow: 0 0 20px rgba(255, 215, 0, 1); }
}

.welcome-btn {
  padding: 14px 28px;
  font-size: 1.2rem;
  font-weight: 600;
  border: none;
  border-radius: 20px;
  background: linear-gradient(135deg, #2196f3, #21cbf3);
  color: white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 140px;
}

.welcome-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 18px rgba(0,0,0,0.2);
}



    </style>
    
</head>
<body>
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-card">
      <p id="welcomeText" style="display:none;"></p>


      <div id="langButtons" style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-top: 10px;">
        <button onclick="chooseLanguage('ar')" class="welcome-btn">ğŸŒ Ø¹Ø±Ø¨ÙŠ</button>
        <button onclick="chooseLanguage('en')" class="welcome-btn">ğŸŒ English</button>
      </div>
      
      <div id="step2" style="display:none; flex-direction: column; gap: 10px;">
        <p id="genderText">ğŸ‘¤ Ø¥Ù†Øª ÙˆÙ„Ø¯ ÙˆÙ„Ø§ Ø¨Ù†ØªØŸ</p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
          <button onclick="chooseGender('male')" class="welcome-btn">ğŸš¹ ÙˆÙ„Ø¯</button>
          <button onclick="chooseGender('female')" class="welcome-btn">ğŸšº Ø¨Ù†Øª</button>
        </div>
      </div>

      <div id="step3" style="display:none; flex-direction: column; gap: 10px;">
        <p id="ageText">ğŸ‚ Ø¹Ù…Ø±Ùƒ Ø£Ù‚Ù„ Ù…Ù† 18 ÙˆÙ„Ø§ Ø£ÙƒØªØ±ØŸ</p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
          <button onclick="chooseAge('under18')" class="welcome-btn">ğŸ”¢ Ø£Ù‚Ù„ Ù…Ù† 18</button>
          <button onclick="chooseAge('above18')" class="welcome-btn">ğŸ”¢ Ø£ÙƒØ¨Ø± Ù…Ù† 18</button>
        </div>
      </div>

      
      <div id="finalStep" style="display:none;"></div>

      
    </div>
  </div>
</div> <!-- Ù†Ù‡Ø§ÙŠØ© welcomeScreen -->

<!-- Ù‡Ù†Ø§ ØªØ­Ø· Ø´Ø§Ø´Ø© avatarIntroScreen Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
<div class="welcome-screen hidden" id="avatarIntroScreen">
  <div id="avatarWrapper" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:20px;">
    
    <div id="introAiBubble" class="ai-bubble show" style="width:120px;height:120px;">
      <div class="bubble-inner" style="width:100%;height:100%;">
        <img id="introAiAvatar" src="assets/ai_default.png" alt="AI" style="width:90px;height:90px;"/>
        <div class="ai-dots">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>
    
    <div id="introAiBoard" class="show" style="
  background: white;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  width: 90%;
  max-width: 400px;
  height: 180px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;">

      <div id="introAiText" style="font-size:1.3rem;color:#2196F3;line-height:1.5;text-align:center;word-wrap:break-word;"></div>
    </div>

  </div>
</div>



  <!-- Screens -->
  <div class="screen active" id="menu">
    <div class="menu-content">
      <h1 class="game-title">Block Puzzle AI</h1>
      <button class="btn start-btn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙŠ</button>
      <button class="btn stats-btn" onclick="showPlayerStats()">ğŸ“ˆ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</button>
      <p class="copyright">By: NovaCode Studio Â© 2025</p>
  
      <div id="adBanner" style="width:100%; height:50px; background:#e6e6e6; display:flex; align-items:center; justify-content:center; font-size:14px; color:#333; margin-top: 20px;">
        Ø¥Ø¹Ù„Ø§Ù† ØªØ¬Ø±ÙŠØ¨ÙŠ Ù‡Ù†Ø§ (Banner)
      </div>
    </div>
  </div>
  
  <div class="screen" id="game">
    <button id="backToMenuBtn" onclick="backToMenu()" class="back-home-btn">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <path d="M19 12H5M12 19l-7-7 7-7" stroke="#2196F3" stroke-width="2"/>
      </svg>
    </button>
    
    <div id="scoreboard">Score: 0</div>
    
    <!-- AI Interactive Area -->
    <div id="aiContainer">
      <div id="aiInteractiveArea">
        <div id="aiBubble" class="ai-bubble hidden">
          <div class="bubble-inner">
            <img id="aiAvatar" src="assets/ai_default.png" alt="AI" />
            <div class="ai-dots">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>
        
        <div id="aiBoard" class="hidden">
          <div id="aiText"></div>
          <div id="aiHeatBar"></div>
        </div>
      </div>
    </div>
    
    <div id="grid"></div>
    <div id="shapes"></div>
  </div>

  <div class="screen" id="gameover">
    <h1>Game Over</h1>
    <div id="finalScoreDisplay"></div>
    <p id="motivationalText" style="font-size: 1.2rem; margin: 10px 0; color: #f4a300; font-weight: bold;"></p>
    <button class="golden-btn" id="resumeBtn" onclick="resumeGame()">âœ¨ Ø§Ø³ØªÙƒÙ…Ù„ Ø§Ù„Ù„Ø¹Ø¨</button>
    <button class="btn" id="restartBtn" style="display:none;" onclick="restartGame()">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
    <button class="btn golden-btn" id="insightBtn" onclick="showInsightReport()" style="margin-top: 10px; font-size: 1.1rem;">...</button>



    <div id="countdown" class="countdown-animate">Ø§Ù†ØªØ¸Ø± 5 Ø«ÙˆØ§Ù†ÙŠ...</div>
  </div>
  
  

  <div id="playerStats" class="welcome-screen" style="display:none;">
    <div class="welcome-card">
      <p id="statsText">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨:</p>
      <div id="statsContent"></div>
      <button class="btn" id="backBtn" onclick="closeStats()">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>
  

  <div class="welcome-screen hidden fade-in" id="insightScreen">
    <div id="insightWrapper" style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:20px;">
      <div id="insightAiBubble" class="ai-bubble show" style="width:120px;height:120px;">
        <div class="bubble-inner" style="width:100%;height:100%;">
          <img id="insightAiAvatar" src="assets/ai_default.png" alt="AI" style="width:90px;height:90px;"/>
          <div class="ai-dots"><span></span><span></span><span></span></div>
        </div>
      </div>
      <div id="insightAiBoard" class="show" style="background: white;padding: 20px;border-radius: 20px;box-shadow: 0 4px 12px rgba(0,0,0,0.1);width: 90%;max-width: 400px;height: 220px;display: flex;align-items: center;justify-content: center;overflow: hidden;">
        <div id="insightAiText" style="font-size:1.2rem;color:#2196F3;line-height:1.5;text-align:center;"></div>
      </div>
      <button id="shareInsightBtn" class="welcome-btn hidden" onclick="shareInsight()">ğŸ”— Ø´Ø§Ø±Ùƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ø¹ ØµØ­Ø§Ø¨Ùƒ</button>
      <button onclick="closeInsight()" class="welcome-btn hidden" id="closeInsightBtn">ğŸ ÙƒÙØ§ÙŠØ© ØªØ­Ù„ÙŠÙ„.. Ù†Ø±Ø¬Ø¹ØŸ</button>
    </div>
  </div>

  

  <div id="aiFlash"></div>
  <script>
 function reloadAIResponses() {
  const savedData = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
  const lang = savedData.language || "ar";
  const gender = savedData.gender || "male";
  const age = savedData.age || "under18";
  const playerType = `${lang}_${gender}_${age}`;

  console.log("ğŸ” Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù€", playerType);

  // Ù‡Ù†Ø§ Ù†Ø­Ø· Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© Ù…Ù† allAIResponses
  if (window.allAIResponses && window.allAIResponses[playerType]) {
    window.aiResponses = window.allAIResponses[playerType];
    console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©");
    window.aiReady = true;
  } else {
    console.error("âŒ Ù…ÙÙŠØ´ Ø¬Ù…Ù„ ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø­Ù…Ù„Ø© Ù„Ù„Ù†ÙˆØ¹ Ø¯Ù‡:", playerType);
    window.aiReady = false;
  }
}






    </script>
    

    <!-- AI Reaction Elements -->




  <script>
    // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø¹Ø¨Ø© ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
    // ÙÙ‚Ø· ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© showAIReaction Ù„ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯
    
    let messageQueue = [];
    let isShowingMessage = false;

    function showAIReaction(eventType) {
  console.log("ğŸ”¥ Ø­Ø¯Ø« AI Ù…Ø·Ù„ÙˆØ¨:", eventType);

  messageQueue.push(eventType);
  if (!isShowingMessage) {
    processMessageQueue();
  }
}


function processMessageQueue() {
  if (messageQueue.length === 0) {
    isShowingMessage = false;
    return;
  }

  isShowingMessage = true;
  const eventType = messageQueue.shift();
  showSingleAIReaction(eventType);
}


function showSingleAIReaction(eventType) {
  console.log("ğŸ”µ Ø¯Ø§Ø®Ù„ showSingleAIReaction Ù„Ù„Ø­Ø¯Ø«:", eventType);

  const aiBubble = document.getElementById("aiBubble");
  const aiBoard = document.getElementById("aiBoard");
  const avatarImg = document.getElementById("aiAvatar");
  const aiText = document.getElementById("aiText");
  const heatBar = document.getElementById("aiHeatBar");

  // ğŸ–¼ï¸ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø¯Ø«
  switch (eventType) {
    case "idle":
      avatarImg.src = "assets/ai_thinking.png";
      break;
    case "combo":
      avatarImg.src = "assets/ai_happy.png";
      break;
    case "lineClear":
      avatarImg.src = "assets/ai_smile.png";
      break;
    case "nearLose":
      avatarImg.src = "assets/ai_worried.png";
      break;
    case "angry":
      avatarImg.src = "assets/ai_angry.png";
      break;
    case "shocked":
      avatarImg.src = "assets/ai_shocked.png";
      break;
    case "embarrassed":
      avatarImg.src = "assets/ai_embarrassed.png";
      break;
    default:
      avatarImg.src = "assets/ai_default.png";
  }
// Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ù†Ø¯ Ø§Ù„ØºØ¶Ø¨ Ø£Ùˆ Ø§Ù„Ù‚Ù„Ù‚
if (eventType === "angry" || eventType === "nearLose") {
  avatarImg.classList.add("shake");
  setTimeout(() => {
  // Ù†Ø¶ÙŠÙ Ø²Ø±Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ø´ÙŠÙƒ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  const avatarWrapper = document.getElementById("avatarWrapper");
  const startBtn = document.createElement("button");
  startBtn.innerText = lang === "ar" ? "ğŸ® ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©!" : "ğŸ® Let's Start!";
  startBtn.className = "welcome-btn";
  startBtn.style.marginTop = "20px";
  startBtn.onclick = () => {

    switchScreen("menu");
  };
  avatarWrapper.appendChild(startBtn);
}, 1500);

}

  const message = getRandomAIResponse(eventType);
  console.log("ğŸŸ¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù„ÙŠ Ø·Ù„Ø¹Øª:", message);

  if (message) {
    showReactionMessage(message);
  } else {
    console.log("ğŸš¨ Ù…ÙÙŠØ´ Ø±Ø³Ø§Ù„Ø© Ø·Ù„Ø¹Øª Ù„Ù„Ø­Ø¯Ø«:", eventType);
  }
}




    // Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
  

    const gameTranslations = {
      ar: {
        startBtn: "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙŠ",
        statsBtn: "ğŸ“ˆ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ",
        scoreText: "Ø§Ù„Ù†Ù‚Ø§Ø·: ",
        gameOver: "Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©",
        resumeBtn: "Ø§Ø³ØªÙƒÙ…Ù„ Ø§Ù„Ù„Ø¹Ø¨ (Ø¥Ø¹Ù„Ø§Ù†)",
        restartBtn: "Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©",
        countdownText: "Ø£Ùˆ Ø§Ù†ØªØ¸Ø± 5 Ø«ÙˆØ§Ù†ÙŠ...",
        aiThinking: "ğŸ¤– ÙŠÙÙƒØ±...",
        statsTitle: "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨",
        backBtn: "ğŸ”™ Ø±Ø¬ÙˆØ¹",
        levelMessage: "Ù…Ø³ØªÙˆØ§Ùƒ: Ø¹Ø§Ù„Ù…ÙŠ"
      },
      en: {
        startBtn: "Start My Journey",
        statsBtn: "ğŸ“ˆ My Stats",
        scoreText: "Score: ",
        gameOver: "Game Over",
        resumeBtn: "Resume Game (Ad)",
        restartBtn: "Start New Game",
        countdownText: "Or wait 5 seconds...",
        aiThinking: "ğŸ¤– Thinking...",
        statsTitle: "Player Stats",
        backBtn: "ğŸ”™ Back",
        levelMessage: "Your Level: Pro"
      }
    };

    
    // Ø¨Ø¹Ø¯ ØªØ¹Ø±ÙŠÙ gameTranslations ÙˆÙ‚Ø¨Ù„ ØªØ¹Ø±ÙŠÙ gridCells
const soundEffects = {
  buttonClick: document.getElementById("sound-button-click"),
  shapePick: document.getElementById("sound-shape-pick"),
  lineClear: document.getElementById("sound-line-clear"),
  comboClear: document.getElementById("sound-combo-clear"),
  bubbleAppear: document.getElementById("sound-bubble-appear"),
  
  play: function(sound) {
    try {
      this[sound].currentTime = 0;
      this[sound].play().catch(e => console.log("Ù„Ù… ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e));
    } catch(e) {
      console.log("Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e);
    }
  }
};
// Ù‡Ù†Ø§ Ù†Ø¶ÙŠÙ Ø¶Ø¨Ø· Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØµÙˆØª â–¼â–¼â–¼
soundEffects.buttonClick.volume = 0.7;    // ØµÙˆØª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
soundEffects.shapePick.volume = 0.6;     // ØµÙˆØª Ø³Ø­Ø¨ Ø§Ù„Ù‚Ø·Ø¹Ø©
soundEffects.lineClear.volume = 0.8;     // ØµÙˆØª Ù…Ø³Ø­ Ø®Ø·
soundEffects.comboClear.volume = 1.0;    // ØµÙˆØª Ù…Ø³Ø­ Ø¹Ø¯Ø© Ø®Ø·ÙˆØ·
soundEffects.bubbleAppear.volume = 0.5;  // ØµÙˆØª Ø¸Ù‡ÙˆØ± Ø§Ù„ÙÙ‚Ø§Ø¹Ø©

    let gridCells = [], shapesInHand = [], shapesUsed = 0, score = 0;
    let difficultyLevel = 1;
    let floatingStartX = 0, floatingStartY = 0, pointerStartX = 0, pointerStartY = 0;
    let aiInternalNotes = [];

    let aiMemory = {
      context: [],
      mood: "neutral",
      lastEvent: null,
      intensity: 0
    };

    let playerBehavior = {
      fastMoves: 0,
      slowMoves: 0,
      perfectClears: 0,
      nearFails: 0,
      lastMoveTime: null,
      avgSpeed: 0,
      totalMoves: 0
    };

    let currentShape = null, sourceElement = null, floating = null;
    let offset = { x: 0, y: 0 }, resumed = false, monitorInterval = null;

    const grid = document.getElementById("grid");
    const shapesDiv = document.getElementById("shapes");
    const scoreboard = document.getElementById("scoreboard");
    const finalScoreDisplay = document.getElementById("finalScoreDisplay");
    const resumeBtn = document.getElementById("resumeBtn");
    const restartBtn = document.getElementById("restartBtn");
    const countdownEl = document.getElementById("countdown");

    const screens = {
      menu: document.getElementById("menu"),
      game: document.getElementById("game"),
      gameover: document.getElementById("gameover")
    };

    const weightedShapes = [
      { shape: [[0,0]], weight: 1 },
      { shape: [[0,0],[1,0]], weight: 2 },
      { shape: [[0,0],[0,1]], weight: 2 },
      { shape: [[0,0],[1,0],[0,1]], weight: 2 },
      { shape: [[0,0],[1,0],[2,0]], weight: 3 },
      { shape: [[0,0],[0,1],[0,2]], weight: 3 },
      { shape: [[0,0],[1,0],[1,1]], weight: 3 },
      { shape: [[0,0],[0,1],[1,1]], weight: 3 },
      { shape: [[0,0],[1,0],[2,0],[0,1],[1,1],[2,1]], weight: 5 }, // 2x3 block
      { shape: [[0,0],[1,0],[2,0],[1,1]], weight: 2 }, // T
      { shape: [[0,0],[0,1],[1,1],[2,1]], weight: 3 },
      { shape: [[0,0],[1,0],[2,0],[3,0]], weight: 5 },
      { shape: [[0,0],[0,1],[0,2],[0,3]], weight: 5 },
      { shape: [[0,0],[1,0],[0,1],[1,1]], weight: 5 },
      { shape: [[0,0],[1,0],[2,0],[0,1],[1,1],[2,1],[0,2],[1,2],[2,2]], weight: 4 }, // 3x3
      { shape: [[0,0],[0,1],[0,2],[1,2],[2,2]], weight: 3 },
      { shape: [[0,0],[2,0],[0,1],[2,1],[0,2],[1,2],[2,2]], weight: 1 }, // U
      { shape: [[0,0],[1,0],[2,0],[1,1],[1,2]], weight: 2 }, // +
      { shape: [[0,0],[1,0],[1,1],[1,2],[2,2]], weight: 1 }, // S
      { shape: [[0,0],[0,1],[1,1],[1,2],[2,2]], weight: 1 }  // Z
    ];

    function switchScreen(screen) {
      Object.values(screens).forEach(s => s.classList.remove("active"));
      screens[screen].classList.add("active");
    }

    function startGame() {
      const btnSound = document.getElementById('sound-button');
  if (btnSound) {
    btnSound.currentTime = 0;
    btnSound.volume = 0.7;
    btnSound.play().catch(e => console.error("Error playing button sound:", e));
  } else {
    console.error("Button sound element not found!");
  }
      if (!window.aiReady) {
  console.log("Ù„Ø³Ù‡ Ù…Ø³ØªÙ†ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù…Ù„...");
  setTimeout(startGame, 100);
  return;
}

      resumed = false;
      let oldBehavior = JSON.parse(localStorage.getItem("blockBehavior") || "{}");
      if (oldBehavior.totalMoves) playerBehavior = oldBehavior;

      switchScreen("game");
      grid.innerHTML = "";
      gridCells = [];
      for (let i = 0; i < 64; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        grid.appendChild(cell);
        gridCells.push(cell);
      }
      score = 0;
      shapesUsed = 0;
      updateScore();
      generateSmartShapes();
      startMonitor();
      showAIReaction('lateOpen');
    }

    function restartGame() {
      soundEffects.play('buttonClick');
      clearInterval(monitorInterval);
      startGame();
    }

    function updateScore() {
      scoreboard.textContent = `Score: ${score}`;
      let smartFactor = 0;
      if (playerBehavior.avgSpeed && playerBehavior.avgSpeed < 2500) smartFactor += 1;
      if (playerBehavior.perfectClears >= 3) smartFactor += 1;
      if (playerBehavior.nearFails === 0 && score > 500) smartFactor += 1;
      difficultyLevel = 1 + smartFactor;
    }

    function xyToIndex(x, y) {
      return y * 8 + x;
    }

    function canPlace(shape, x, y) {
      return shape.every(([dx, dy]) => {
        const gx = x + dx, gy = y + dy;
        return gx >= 0 && gx < 8 && gy >= 0 && gy < 8 &&
          !gridCells[xyToIndex(gx, gy)].classList.contains("filled");
      });
    }

    function canShapeFitAnywhere(shape) {
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          if (canPlace(shape, x, y)) return true;
        }
      }
      return false;
    }

    function rotateShape(shape, times = 1) {
      let result = shape.map(([x, y]) => [x, y]);
      for (let t = 0; t < times; t++) {
        result = result.map(([x, y]) => [y, -x]);
        const minX = Math.min(...result.map(([x]) => x));
        const minY = Math.min(...result.map(([_, y]) => y));
        result = result.map(([x, y]) => [x - minX, y - minY]);
      }
      return result;
    }

    function createShapeElement(shape) {
      const el = document.createElement("div");
      el.className = "shape";

      const minX = Math.min(...shape.map(([x]) => x));
      const minY = Math.min(...shape.map(([_, y]) => y));

      shape.forEach(([x, y]) => {
        const block = document.createElement("div");
        block.className = "block";
        block.style.gridColumn = (x - minX + 1);
        block.style.gridRow = (y - minY + 1);
        el.appendChild(block);
      });

      el.dataset.shape = JSON.stringify(shape);
      return el;
    }

    function getRandomWeightedShape() {
      let filtered = weightedShapes.filter(s => s.shape.length <= (5 + difficultyLevel));
      let totalWeight = filtered.reduce((sum, s) => sum + s.weight, 0);
      let rand = Math.random() * totalWeight;
      for (let s of filtered) {
        if (rand < s.weight) return s.shape;
        rand -= s.weight;
      }
    }

    function generateSmartShapes() {
      shapesDiv.innerHTML = "";
      shapesUsed = 0;
      shapesInHand = [];
      let tries = 0;
      const shape = getRandomWeightedShape();

      while (shapesInHand.length < 3 && tries < 100) {
        let shape = getRandomWeightedShape();
        let rotation = Math.floor(Math.random() * 4);
        shape = rotateShape(shape, rotation);

        if (Math.random() < 0.3 && isLineClearShape(shape)) {
  shapesInHand.push(shape);
  continue; // Ù†ÙƒÙ…Ù„ Ø¹Ù„Ù‰ Ø·ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ÙØ­Øµ
}

function isLineClearShape(shape) {
  const xs = shape.map(([x, _]) => x);
  const ys = shape.map(([_, y]) => y);
  const uniqueX = new Set(xs).size;
  const uniqueY = new Set(ys).size;

  // Ø´ÙƒÙ„ Ù…Ø±ØµÙˆØµ Ø£ÙÙ‚ÙŠÙ‹Ø§ Ø£Ùˆ Ø¹Ù…ÙˆØ¯ÙŠÙ‹Ø§ (ÙŠØ¹Ù†ÙŠ Ø´ÙƒÙ„Ù‡ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ù…Ø³Ø­)
  return uniqueY === 1 || uniqueX === 1;
}


        if (canShapeFitAnywhere(shape)) {
          shapesInHand.push(shape);
        }
        tries++;
      }

      shapesInHand.forEach(shape => {
        const el = createShapeElement(shape);
        shapesDiv.appendChild(el);

        el.addEventListener("pointerdown", e => {
          // ÙÙŠ Ø¯Ø§Ù„Ø© generateSmartShapes() Ø¯Ø§Ø®Ù„ eventListener Ù„Ù„Ù€ pointerdown
el.addEventListener("pointerdown", e => {
  e.preventDefault();
  soundEffects.play('shapePick'); // <-- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
  sourceElement = el;
  // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ
});
          e.preventDefault();
          sourceElement = el;
          const rect = el.getBoundingClientRect();
          const cellSize = gridCells[0].getBoundingClientRect().width;
          offset.x = e.clientX - rect.left;
          offset.y = e.clientY - rect.top;

          pointerStartX = e.pageX;
          pointerStartY = e.pageY;

          floatingStartX = e.pageX;
          floatingStartY = e.pageY - (cellSize * 4);

          currentShape = shape;
          floating = el.cloneNode(true);
          floating.classList.add("floating");
          floating.style.width = `${cellSize * 4}px`;
          floating.style.height = `${cellSize * 4}px`;
          floating.style.left = (floatingStartX - offset.x) + "px";
          floating.style.top = (floatingStartY - offset.y) + "px";

          el.style.visibility = "hidden";
          document.body.appendChild(floating);
        });
      });
    }

    function placeShape(shape, x, y) {
      shape.forEach(([dx, dy]) => {
        gridCells[xyToIndex(x+dx, y+dy)].classList.add("filled");
      });
      score += shape.length * 10;
      checkFullLines();
      updateScore();
      shapesUsed++;

      let now = Date.now();
      if (playerBehavior.lastMoveTime) {
        let delta = now - playerBehavior.lastMoveTime;
        playerBehavior.totalMoves++;
        if (delta < 3000) playerBehavior.fastMoves++;
        else playerBehavior.slowMoves++;
        playerBehavior.avgSpeed = (playerBehavior.avgSpeed * (playerBehavior.totalMoves - 1) + delta) / playerBehavior.totalMoves;
      }
      playerBehavior.lastMoveTime = now;

      if (score > 700 && playerBehavior.fastMoves > playerBehavior.slowMoves) {
        aiInternalNotes.push(`Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø³Ø±ÙŠØ¹ ÙˆØ¹Ø¯ÙˆØ§Ù†ÙŠ... Ø§Ø­ØªÙ…Ø§Ù„ ÙƒØ¨ÙŠØ± ÙŠÙˆØµÙ„ Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ø§Ù„ÙŠØ©.`);
      }
      if (playerBehavior.nearFails >= 3) {
        aiInternalNotes.push(`Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨ÙŠÙ†Ù‡Ø§Ø± Ø¨Ø³Ù‡ÙˆÙ„Ø©... Ù…Ø­ØªØ§Ø¬ ØªØ­ÙÙŠØ² Ù…Ø®ØªÙ„Ù.`);
      }
      if (score > 1000 && playerBehavior.perfectClears > 5) {
        aiInternalNotes.push(`Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø¨Ø¯Ø£Øª ØªØ¸Ù‡Ø± Ø¨ÙˆØ¶ÙˆØ­... Ù„Ø§Ø²Ù… Ø£Ø±ÙØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ.`)
      }

      if (shapesUsed >= 3) {
        generateSmartShapes();
      }
    }


    function checkFullLines() {
  let clearedRows = [], clearedCols = [];

  // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„ÙØ­Øµ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
  for (let row = 0; row < 8; row++) {
    if ([...Array(8)].every((_, col) => gridCells[xyToIndex(col, row)].classList.contains("filled"))) {
      clearedRows.push(row);
    }
  }

  // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„ÙØ­Øµ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
  for (let col = 0; col < 8; col++) {
    if ([...Array(8)].every((_, row) => gridCells[xyToIndex(col, row)].classList.contains("filled"))) {
      clearedCols.push(col);
    }
  }

  if (clearedRows.length || clearedCols.length) {
    const totalCleared = clearedRows.length + clearedCols.length;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙˆØ§Øª Ù‡Ù†Ø§ â–¼â–¼â–¼
    if (totalCleared === 1) {
      soundEffects.play('lineClear'); // ØµÙˆØª Ù„Ù…Ø³Ø­ Ø®Ø· ÙˆØ§Ø­Ø¯
    } else {
      soundEffects.play('comboClear'); // ØµÙˆØª Ù„Ù…Ø³Ø­ ÙƒÙˆÙ…Ø¨Ùˆ (Ø¹Ø¯Ø© Ø®Ø·ÙˆØ·)
    }
    if (totalCleared === 1) {
  if (soundEffects && soundEffects.play) {
    soundEffects.play('lineClear');
  }
} else {
  if (soundEffects && soundEffects.play) {
    soundEffects.play('comboClear');
  }
}
    // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù…Ø³Ø­ Ø§Ù„Ø®Ø·ÙˆØ·
    clearedRows.forEach(row => {
      for (let col = 0; col < 8; col++) {
        gridCells[xyToIndex(col, row)].classList.remove("filled");
      }
    });

    clearedCols.forEach(col => {
      for (let row = 0; row < 8; row++) {
        gridCells[xyToIndex(col, row)].classList.remove("filled");
      }
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
    score += totalCleared * 100;
    updateScore();

    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø¯ ÙØ¹Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    setTimeout(() => {
      if (totalCleared >= 2) {
        showAIReaction('combo');
      } else {
        showAIReaction('lineClear');
      }
    }, 100);
  }
}

    function showGameOver() {
  clearInterval(monitorInterval);
  playerBehavior.nearFails++;

  switchScreen("gameover");

  finalScoreDisplay.classList.remove("show", "bounce-in");
  resumeBtn.style.display = "inline-block";
  resumeBtn.classList.add("golden-btn");
  restartBtn.style.display = "none";
  countdownEl.style.display = "block";

  // Ù†Øµ Ø¹Ø§Ø·ÙÙŠ Ù…Ø¨Ø·Ù† ÙˆØ¬Ø°Ø§Ø¨
  const motivationalMessages = [
    
  ];
  document.getElementById("motivationalText").textContent = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];

  startResumeCountdown();
}




function resumeGame() {
  showRewardedAd();
}

function showRewardedAd() {
  alert("ğŸ¥ Ø¥Ø¹Ù„Ø§Ù† Ø³ÙŠØ¹Ø±Ø¶ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§.");

  resumed = true;
  clearRandomLine();
  generateSmartShapes();
  switchScreen("game");
  startMonitor();
}



function showRewardedAd() {
  // Ù…ÙƒØ§Ù† Ø±Ø¨Ø· Ø¥Ø¹Ù„Ø§Ù† Ø¬ÙˆØ¬Ù„ AdMob Ù„Ù…Ø§ ØªØ¹Ù…Ù„ Ù†Ø³Ø®Ø© APK
  console.log("ğŸ“º Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª!");

  resumed = true;
  clearRandomLine();
  generateSmartShapes();
  switchScreen("game");
  startMonitor();
}


function showRewardedAd() {
  // â— Ø¯Ù‡ Ù…ÙƒØ§Ù† Ø±Ø¨Ø· Ø¥Ø¹Ù„Ø§Ù† AdMob Ù„Ù…Ø§ ØªØ¨Ù†ÙŠ Ø§Ù„Ù€ APK
  console.log("ğŸ“º Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©!");

  // Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ù†ÙƒÙ…Ù„ Ø§Ù„Ù„Ø¹Ø¨ ÙƒØ£Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§ØªØ´Ø§Ù
  resumed = true;
  clearRandomLine();
  generateSmartShapes();
  switchScreen("game");
  startMonitor();
}



function showRewardedAdWithCallback(callback) {
  // Ù‡Ù†Ø§ Ù…ÙƒØ§Ù† Ø±Ø¨Ø· Ø¥Ø¹Ù„Ø§Ù† AdMob Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§
  console.log("ğŸ“º Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù…ÙƒØ§ÙØ£Ø© (Ù…Ø¹ ØªÙ†ÙÙŠØ° Ø¨Ø¹Ø¯Ù‡)");

  // Ø¯Ù„ÙˆÙ‚ØªÙŠ Ø¨Ù†ÙØªØ±Ø¶ Ø¥Ù†Ù‡ Ø®Ù„Øµ
  setTimeout(() => {
    callback();
  }, 500); // Ù…Ù…ÙƒÙ† ØªØ²ÙˆØ¯ ÙˆÙ‚Øª Ø§Ù„Ø¹Ø±Ø¶ Ù„Ùˆ Ø­Ø¨ÙŠØª ØªØ­Ø§ÙƒÙŠ Ø¥Ø¹Ù„Ø§Ù† Ø£Ø·ÙˆÙ„
}



function generateInsightReport() {
  const textArea = document.getElementById("insightAiText");
  const avatar = document.getElementById("insightAiAvatar");
  const dots = document.querySelector("#insightAiBubble .ai-dots");
  const shareBtn = document.getElementById("shareInsightBtn");
  const closeBtn = document.getElementById("closeInsightBtn");

  const b = playerBehavior;
  const lang = JSON.parse(localStorage.getItem("blockPlayerData"))?.language || 'ar';
  const rand = arr => arr[Math.floor(Math.random() * arr.length)];

  let message = "";

  if (lang === 'ar') {
    const opening = [
      "ğŸ“˜ ØªØ­Ù„ÙŠÙ„ Ø³Ø±ÙŠØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¬ÙˆÙ„ØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø©...",
      "ğŸ§  Ø§Ù„Ø¨ÙŠØ¶Ø© Ù‚Ø¹Ø¯Øª ØªØ­Ù„Ù„ ÙˆØ·Ù„Ø¹ØªÙ„Ùƒ Ø§Ù„ÙƒÙ„Ø§Ù… Ø¯Ù‡...",
      "ğŸ­ ÙƒÙ„ Ø­Ø±ÙƒØ© Ù„ÙŠÙƒ ÙƒØ§Ù†Øª Ø¨ØªØªÙƒÙ„Ù…... Ø§Ø³Ù…Ø¹ Ø¨Ù‚Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù….",
      "ğŸ‘ï¸ Ø®Ù„ÙŠÙ†ÙŠ Ø£Ù‚ÙˆÙ„Ùƒ Ø¥Ù†Øª ÙƒÙ†Øª Ø¹Ø§Ù…Ù„ Ø¥Ø²Ø§ÙŠ ÙˆØ§Ù†Øª Ø¨ØªÙ„Ø¹Ø¨.",
      "ğŸ¤– Ø¬ÙˆÙ„ØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø© ÙØ¶Ø­ØªÙ„Ùƒ Ø­Ø§Ø¬Ø§ØªØŒ ÙˆØ£Ù†Ø§ Ø¬Ù…Ø¹ØªÙ‡Ø§.",
      "ğŸ“Š Ø§Ù„Ø¨ÙŠØ¶Ø© Ø³Ø¬Ù„ØªØŒ ÙˆØ¯Ù‡ Ø§Ù„Ù„ÙŠ Ø·Ù„Ø¹.",
      "ğŸ§© Ù„Ø¹Ø¨Ùƒ Ù‚Ø§Ù„ ÙƒØªÙŠØ±ØŒ ÙˆØ£Ù†Ø§ ØªØ±Ø¬Ù…Øª Ø§Ù„ÙƒÙ„Ø§Ù… Ø¯Ù‡ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¯Ù‡.",
      "ğŸ•µï¸â€â™‚ï¸ Ø¨ØµØ±Ø§Ø­Ø©ØŸ Ø¬ÙˆÙ„ØªÙƒ ÙƒØ§Ù†Øª ÙƒÙ†Ø² Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.",
      "ğŸ® ØªØ­Ù„ÙŠÙ„ Ø¹ Ø§Ù„Ø³Ø±ÙŠØ¹ØŒ Ø¨Ø³ Ù…Ù† Ù‚Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ¶Ø©.",
      "ğŸ’¡ Ù…Ø³ØªØ¹Ø¯ ØªØ³Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©ØŸ"
    ];

    const emotion = b.fastMoves > b.slowMoves ? [
      "Ø¨ØªØªØ­Ø±Ùƒ Ø¨Ø³Ø±Ø¹Ø© ÙƒØ£Ù† ÙÙŠ Ø­Ø¯ Ø¨ÙŠØ¬Ø±ÙŠ ÙˆØ±Ø§Ùƒ ğŸ˜…",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ù…Ø´ Ø¨ØªÙÙƒØ± ÙƒØªÙŠØ± Ù‚Ø¨Ù„ Ù…Ø§ ØªØªØ­Ø±ÙƒØŒ ÙˆÙŠÙ…ÙƒÙ† Ø¯Ù‡ Ø¬Ø²Ø¡ Ù…Ù† Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ø¹ÙÙˆÙŠØ©.",
      "ØªØ­Ø±ÙƒØ§ØªÙƒ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø¨ØªÙ‚ÙˆÙ„ Ø¥Ù†Ùƒ Ù…ØªØ­Ù…Ø³ Ø£Ùˆ Ù…Ø³ØªØ¹Ø¬Ù„ Ø¯Ø§ÙŠÙ…Ù‹Ø§.",
      "ÙÙŠÙ‡ Ø§Ø³ØªØ¹Ø¬Ø§Ù„ Ø¨Ø§ÙŠÙ† ÙÙŠ ÙƒÙ„ Ø®Ø·ÙˆØ©ØŒ Ø¯Ù‡ Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Ù…Ù† Ø§Ù„ØªÙˆØªØ± Ø£Ùˆ Ø§Ù„Ø­Ù…Ø§Ø³.",
      "Ø§Ù„Ø³Ø±Ø¹Ø© Ø¹Ù†Ø¯Ùƒ Ø¨ØªØ®Ù„ÙŠÙƒ ØªØ§Ø®Ø¯ Ù‚Ø±Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©ØŒ Ø­Ù„ÙˆØ© Ø¨Ø³ Ù…Ø´ Ø¯Ø§ÙŠÙ…Ù‹Ø§ Ø¯Ù‚ÙŠÙ‚Ø©.",
      "Ø¨ØªÙ‡Ø±Ø¨ Ù…Ù† Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„ÙƒØªÙŠØ±ØŸ Ø§Ù„Ù„Ø¹Ø¨ Ø¨ÙŠÙ‚ÙˆÙ„ ÙƒØ¯Ù‡.",
      "Ø§Ù„Ø³Ø±Ø¹Ø© Ù…Ù„Ø­ÙˆØ¸Ø©â€¦ Ø¨Ø³ ÙŠØ§ØªØ±Ù‰ ÙˆØ±Ø§Ù‡Ø§ Ø«Ù‚Ø© ÙˆÙ„Ø§ Ù‚Ù„Ù‚ØŸ",
      "Ø²ÙŠ Ù…Ø§ ØªÙƒÙˆÙ† Ø¨ØªÙ„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„ÙˆÙ‚Øª! ÙÙŠÙ† Ø§Ù„Ø±Ø§Ø­Ø©ØŸ ğŸ˜†",
      "Ø§Ù„Ù„ÙŠ ÙŠØ´ÙˆÙÙƒ ÙŠÙÙƒØ± Ø¥Ù†Ùƒ Ø­Ø§ÙØ¸ Ø§Ù„Ø­Ù„â€¦ Ø¨Ø³ ÙŠÙ…ÙƒÙ† Ø¨ØªØ¬Ø±Ø¨ØŸ",
      "Ø¥Ù†Øª Ø£Ø³Ø±Ø¹ Ù…Ù† Ø§Ù„Ø¨ÙŠØ¶Ø© ÙˆÙ‡ÙŠ Ø¨ØªØªÙƒÙ„Ù… Ø£ØµÙ„Ø§Ù‹ ğŸ˜³"
    ] : [
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ø¨ØªÙÙƒØ± ÙƒÙˆÙŠØ³ Ù‚Ø¨Ù„ Ù…Ø§ ØªØªØ­Ø±Ùƒâ€¦ Ø¨Ø³ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ÙØ±Øµ Ø¨ØªÙ‡Ø±Ø¨ Ù…Ù†Ùƒ.",
      "Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ø¨Ø§ÙŠÙ† ÙÙŠ Ø·Ø±ÙŠÙ‚Ø© Ù„Ø¹Ø¨Ùƒâ€¦ ÙˆØ¯Ù‡ Ø¨ÙŠÙ‚ÙˆÙ„ Ø¥Ù†Ùƒ Ø¨ØªØ­Ø¨ Ø§Ù„ØªØ®Ø·ÙŠØ·.",
      "ÙƒÙ„ Ø­Ø±ÙƒØ© Ù„ÙŠÙƒ Ù…Ø­Ø³ÙˆØ¨Ø©â€¦ Ø¨Ø³ Ø£ÙˆÙ‚Ø§Øª Ø¨ØªØ­Ø³ Ø¥Ù†Ùƒ Ù…ØªØ±Ø¯Ø¯ØŸ",
      "Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø·ÙˆÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø¨ÙŠÙƒÙˆÙ† Ù†Ù‚Ø·Ø© Ù‚ÙˆØ©â€¦ ÙˆØ£ÙˆÙ‚Ø§Øª Ø¨ÙŠØ¶ÙŠØ¹ Ø¬ÙˆÙ„Ø§Øª.",
      "Ø§Ù†ØªØ¨Ù‡â€¦ Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ø¯Ù‡ Ù…Ù…ÙƒÙ† ÙŠØ®Ø¯Ø¹ØŒ Ù‡Ù„ Ù‡Ùˆ ØªØ±ÙƒÙŠØ² ÙˆÙ„Ø§ ØªØ±Ø¯Ø¯ØŸ",
      "ÙƒØ£Ù†Ùƒ Ø¨ØªØ³ØªÙ†Ù‰ Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„ØµØ­ ÙƒÙ„ Ù…Ø±Ø©â€¦ Ø§Ø­ØªØ±Ø§Ù… âœ¨",
      "Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ù…Ù…ÙƒÙ† ÙŠØ®Ù„ÙŠÙƒ ØªØªØ£Ø®Ø±â€¦ Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø¨ØªØ³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ø±Ø­Ù„Ø©ØŸ",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ø¨ØªÙ„Ø¹Ø¨ Ø¨Ø¹Ù‚Ù„Ùƒ Ù…Ø´ Ø¨Ø¥ÙŠØ¯Ùƒ.",
      "Ø·Ø±ÙŠÙ‚Ø© Ù„Ø¹Ø¨Ùƒ ÙÙŠÙ‡Ø§ ÙˆØ¹ÙŠâ€¦ Ø¨Ø³ Ø§Ù„ÙˆØ¹ÙŠ Ø³Ø§Ø¹Ø§Øª Ø¨ÙŠÙƒÙˆÙ† ØªÙ‚ÙŠÙ„.",
      "ÙƒØ£Ù†Ùƒ Ø¨ØªØ³Ù…Ø¹ Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙˆØ§Ù†Øª Ø¨ØªØ­Ø±ÙƒØŒ ÙÙŠÙƒ Ù„Ù…Ø³Ø© ÙÙ†ÙŠØ© ğŸ¶"
    ];

    const risk = b.nearFails >= 3 ? [
      "ÙƒÙ†Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ© Ø£ÙƒØªØ± Ù…Ù† Ù…Ø±Ø©â€¦ Ø¨ØªØ­Ø¨ Ø§Ù„ØªÙˆØªØ±ØŸ ğŸ˜…",
      "Ø¨ØªÙ„Ø¹Ø¨ ÙƒØ£Ù†Ùƒ ÙÙŠ Ù…Ø´Ù‡Ø¯ Ù†Ù‡Ø§ÙŠØ© ÙÙŠÙ„Ù… Ø£ÙƒØ´Ù†!",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ø¨ØªÙ…Ø´ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ùƒâ€¦ ÙˆØ¯Ù‡ Ù…Ø­ØªØ§Ø¬ Ø£Ø¹ØµØ§Ø¨.",
      "Ø§Ù„Ø®Ø·Ø± Ø¨ÙŠØ´Ø¯ÙƒØŸ ÙˆÙ„Ø§ Ø¯Ù‡ ØµØ¯ÙØ© Ù…ØªÙƒØ±Ø±Ø©ØŸ",
      "Ø§Ù„Ù†Ø¬Ø§Ø© ÙÙŠ Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø´ÙƒÙ„Ù‡Ø§ Ø¹Ø§Ø¯ØªÙƒ ğŸ˜‚",
      "Ø¨ØªØªØ£Ø®Ø± ÙÙŠ Ø§Ù„ØªØµØ±Ùâ€¦ ÙˆØ¨ØªÙ†Ù‚Ø° Ù†ÙØ³Ùƒ ÙÙŠ Ø¢Ø®Ø± Ø«Ø§Ù†ÙŠØ©.",
      "Ø§Ù„Ø¨ÙŠØ¶Ø© Ø³Ø¬Ù„Øª: Ø£ÙƒØªØ± Ù…Ù† Ù…Ø±Ø© ÙƒØ¯Øª ØªØ®Ø³Ø±â€¦ Ø¨Ø³ Ù†Ø¬ÙŠØª.",
      "ÙÙŠÙƒ Ø­Ø§Ø¬Ø© Ø¨ØªØ®Ù„ÙŠÙƒ Ù…Ø§ ØªØ³ØªØ³Ù„Ù…Ø´â€¦ Ø­ØªÙ‰ ÙˆØ§Ù†Øª Ø¨ØªÙ‚Ø¹.",
      "ÙƒØ£Ù†Ùƒ Ø¨ØªØ­Ø¨ Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø±Ø¬Ø©â€¦ ØºØ±ÙŠØ¨ ÙˆÙ…Ø«ÙŠØ±.",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ø¨ØªÙ…Ø´ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø¨ÙŠÙ† Ø§Ù„Ù†ØµØ± ÙˆØ§Ù„Ù‡Ø²ÙŠÙ…Ø©!"
    ] : [
      "ÙƒÙ†Øª Ù…ØªÙ…Ø§Ø³Ùƒâ€¦ ÙˆØ§Ù„Ø¬ÙˆÙ„Ø© Ù…Ø§Ø´ÙŠØ© ØªØ­Øª Ø³ÙŠØ·Ø±ØªÙƒ.",
      "ØªØ­ÙƒÙ…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ø¶Ø­â€¦ ÙˆØ¹Ù‚Ù„Ùƒ Ù…Ø±ØªØ§Ø­.",
      "ÙˆÙ„Ø§ Ù„Ø­Ø¸Ø© ÙƒØ§Ù†Øª Ø®Ø·Ø±Ø©â€¦ Ø¯Ù‡ Ø¨ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø«Ù‚Ø©.",
      "Ù‡Ø¯ÙˆØ¡Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù ÙŠØ¹Ù„Ù‘Ù….",
      "Ø£Ù†Øª Ù…Ù† Ø§Ù„Ù†Ø§Ø³ Ø§Ù„Ù„ÙŠ ØªØ¹Ø±Ù ØªØªØµØ±Ù Ù‚Ø¨Ù„ Ù…Ø§ Ø§Ù„Ø£Ù…ÙˆØ± ØªØªØ¹Ù‚Ø¯.",
      "Ø§Ù„Ù„Ø¹Ø¨Ø© ÙƒØ§Ù†Øª ÙÙŠ Ø¬ÙŠØ¨Ùƒ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.",
      "Ø¨Ø±Ø§ÙÙˆâ€¦ Ø§Ù„Ø¬ÙˆÙ„Ø© ÙƒØ§Ù†Øª ÙÙŠÙ‡Ø§ Ø£Ù…Ø§Ù† Ø£ÙƒØªØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø²Ù….",
      "Ø§Ù„Ø¨ÙŠØ¶Ø© Ø´Ø§ÙØªÙƒâ€¦ ÙƒÙ†Øª Ø¨ØªÙ‡Ù†Ø¯Ù„ Ø§Ù„Ù„Ø¹Ø¨ ÙƒØ£Ù†Ùƒ Ø¨ØªØ´Ø±Ø¨ Ø´Ø§ÙŠ.",
      "Ø³ÙŠØ·Ø±ØªÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ù ØªØ³ØªØ­Ù‚ ØªØµÙÙŠÙ‚ ğŸ‘",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ù…Ø§ Ø¨ØªØ­Ø¨ Ø§Ù„Ø¯Ø±Ø§Ù…Ø§â€¦ ÙƒÙ„ Ø­Ø§Ø¬Ø© ÙƒØ§Ù†Øª ØªØ­Øª Ø§Ù„ÙƒÙ†ØªØ±ÙˆÙ„."
    ];

    const personality = b.perfectClears >= 3 ? [
      "Ø¥Ø¨Ø¯Ø§Ø¹Ùƒ Ø¨ÙŠØ¸Ù‡Ø± Ù„Ù…Ø§ Ø§Ù„Ø¯Ù†ÙŠØ§ ØªØ¶ÙŠÙ‚ØŒ ÙˆØ¯Ù‡ Ø¨ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø¹Ù‚Ù„ Ù†Ø´ÙŠØ·.",
      "ÙÙŠÙƒ Ø­Ø§Ø¬Ø© ØªØ®Ù„ÙŠÙƒ ØªÙƒÙ…Ù‘Ù„ ÙˆØªÙØ§Ø¬Ø¦Ù†Ø§ Ø¨Ø­Ù„ Ø¹Ø¨Ù‚Ø±ÙŠ.",
      "Ø¹Ø±ÙØª ØªÙ†ÙØ° ÙƒÙ…Ø¨Ùˆ Ù…Ø­ØªØ±Ù…ØŒ Ø¯Ù‡ Ø°ÙƒØ§Ø¡ Ù…Ø´ Ø³Ù‡Ù„.",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ù…Ø´ Ø¨Ø³ Ø¨ØªÙ„Ø¹Ø¨â€¦ Ø¥Ù†Øª Ø¨ØªØ­Ù„Ù„ ÙˆØ¨ØªØ®Ø·Ø·.",
      "Ø§Ù„Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù†Ø¸ÙŠÙØ© Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„ØªÙ‡Ø§ Ø¨ØªÙ‚ÙˆÙ„ Ø¥Ù†Ùƒ Ù…Ø±ÙƒØ² Ù‚ÙˆÙŠ.",
      "Ø¨ØªØ¹Ø±Ù ØªØªØµØ±Ù Ù„Ù…Ø§ Ø§Ù„ÙØ±ØµØ© ØªÙŠØ¬ÙŠâ€¦ Ø¯Ù‡ Ù…Ø¹Ù†Ø§Ù‡ Ø¥Ù†Ùƒ ÙˆØ§Ø¹ÙŠ.",
      "ÙƒÙ„ Perfect Clear Ø¨ØªÙ‚ÙˆÙ„ Ø¥Ù†Ùƒ Ù…Ø´ Ø¹Ø´ÙˆØ§Ø¦ÙŠ.",
      "Ø¹Ù‚Ù„Ùƒ Ø¨ÙŠØ´ØªØºÙ„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙŠÙ…Ù‹Ø§â€¦ Ø¨Ø§ÙŠÙ† Ø¬Ø¯Ù‹Ø§.",
      "ÙÙŠÙƒ Ù„Ù…Ø³Ø© ØªÙƒØªÙŠÙƒÙŠØ© ÙˆØ§Ø¶Ø­Ø©.",
      "Ø§Ù„Ø¨ÙŠØ¶Ø© Ø§Ø­ØªØ±Ù…Øª ÙƒÙ…Ø¨Ùˆ Ø²ÙŠ Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„ØªÙ‡."
    ] : [
      "ÙÙŠÙ‡ Ù„Ø®Ø¨Ø·Ø© ÙÙŠ Ù‚Ø±Ø§Ø±Ø§ØªÙƒâ€¦ ÙŠÙ…ÙƒÙ† Ù…Ø²Ø§Ø¬ØŸ ÙŠÙ…ÙƒÙ† ØªÙˆØªØ±ØŸ",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ø¨ØªØ¬Ø±Ø¨ Ø£ÙƒØªØ± Ù…Ø§ Ø¨ØªØ­Ø³Ø¨â€¦ ÙƒÙˆÙŠØ³ Ù„Ù„ØªØ¹Ù„Ù‘Ù…ØŒ Ø¨Ø³ Ù…Ø´ Ø¯Ø§ÙŠÙ…Ù‹Ø§.",
      "Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ Ù…Ø§ÙƒØ§Ù†Ø´ Ø­Ù„ÙŠÙÙƒ Ø§Ù„Ù…Ø±Ø© Ø¯ÙŠâ€¦ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø¬Ø§ÙŠØ©.",
      "Ø¥Ù†Øª Ù…Ø´ Ø¨ØªØ®Ø·Ø· Ø¨Ø¹ÙŠØ¯â€¦ Ø¨ØªØ­Ø¨ ØªÙ…Ø´ÙŠÙ‡Ø§ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©ØŸ",
      "Ø£Ø¯Ø§Ø¡Ùƒ Ù…ØªØ°Ø¨Ø°Ø¨â€¦ Ø¨Ø³ Ø¯Ù‡ Ø¨ÙŠØ­ØµÙ„ Ù„Ø£Ø°ÙƒÙ‰ Ø§Ù„Ù†Ø§Ø³.",
      "ÙƒØ£Ù†Ùƒ ÙƒÙ†Øª Ø¨ØªÙ„Ø¹Ø¨ ÙˆØ§Ù†Øª Ø¨ØªÙÙƒØ± ÙÙŠ Ø­Ø§Ø¬Ø© ØªØ§Ù†ÙŠØ©ØŸ",
      "Ø§Ù„Ø¨ÙŠØ¶Ø© Ø´Ø§ÙØª Ø¥Ù†Ùƒ Ù…Ø±ÙƒØ² Ø¨Ø³ Ù…Ø´ Ø¯Ù‚ÙŠÙ‚ ÙƒÙØ§ÙŠØ©.",
      "Ù…Ø§ÙÙŠØ´ ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„â€¦ Ø¨Ø³ ÙÙŠÙ‡ Ù†ÙŠØ© ÙˆØ§Ø¶Ø­Ø©.",
      "ÙƒÙ†Øª Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø­Ù„ÙˆÙ„ ÙƒÙˆÙŠØ³Ø©â€¦ Ø¨Ø³ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‡Ø±Ø¨Øª Ù…Ù†Ùƒ.",
      "ÙˆØ§Ø¶Ø­ Ø¥Ù†Ùƒ Ù„Ø³Ù‡ Ø¨ØªØªØ¹Ù„Ù… ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø³Ø±ÙŠØ¹ ÙˆØ§Ù„Ø¯Ù‚ÙŠÙ‚."
    ];
    const closing = [
      "Ø¯Ù‡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¯ÙŠâ€¦ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø¬Ø§ÙŠØ© ØªÙ‚ÙˆÙ„Ù„ÙŠ Ø´Ø®ØµÙŠØ© ØªØ§Ù†ÙŠØ©ØŸ",
      "Ø£Ù†Ø§ Ø§Ù„Ø¨ÙŠØ¶Ø©â€¦ ÙˆØ³Ø¬Ù„Øª ÙƒÙ„ Ø­Ø§Ø¬Ø©. Ø§Ù„Ø¬ÙŠÙ… Ø§Ù„Ø¬Ø§ÙŠØŸ Ù…ÙØ§Ø¬Ø£Ø© Ø¬Ø¯ÙŠØ¯Ø©.",
      "ÙƒÙ„ Ø­Ø±ÙƒØ© Ù„ÙŠÙƒ Ø¨ØªÙ‚ÙˆÙ„ Ø­Ø§Ø¬Ø©â€¦ ÙˆØ£Ù†Ø§ Ù‡Ù†Ø§ Ø£Ø±Ø§Ù‚Ø¨.",
      "Ø¥Ù†Øª Ù†Ø³Ø®Ø© Ø¨ØªØªØºÙŠØ± ÙƒÙ„ Ø¬ÙˆÙ„Ø©â€¦ ÙˆØ¯Ù‡ Ø£Ø­Ù„Ù‰ Ø­Ø§Ø¬Ø©.",
      "ÙƒÙ„ Ø¬ÙˆÙ„Ø© Ø¨ØªÙƒØ´ÙÙ„Ùƒ Ø­Ø§Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠÙƒ.",
      "Ø£Ù†Ø§ Ø¨Ø­Ù„Ù„Ùƒâ€¦ ÙˆØ§Ù„Ø¬ÙŠÙ… Ø¨ÙŠØ·Ù„Ø¹ Ø§Ù„Ù„ÙŠ Ø¬ÙˆØ§Ùƒ.",
      "Ø§Ø³ØªÙ…Ø±â€¦ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ø§ÙŠ Ù‡ÙŠÙƒÙˆÙ† Ø£ØºØ±Ø¨.",
      "Ù„Ùˆ Ø¯ÙŠ ÙƒØ§Ù†Øª Ù…Ø¬Ø±Ø¯ Ø¬ÙˆÙ„Ø©â€¦ ÙØ¥Ù†Øª Ù„Ø³Ù‡ Ù…Ø®Ø¨ÙŠØªÙ„ÙŠ ÙƒØªÙŠØ±.",
      "Ø§Ù„Ø¨ÙŠØ¶Ø© Ù„Ø³Ù‡ Ø¨ØªØªØ¹Ù„Ù… Ø¹Ù†Ùƒâ€¦ Ø¨Ø³ Ø¨Ø¯Ø£Øª Ø£ÙÙ‡Ù…Ùƒ.",
      "Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø®Ù„Øµâ€¦ Ø¨Ø³ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø³Ù‡ Ù‚Ø¯Ø§Ù…Ùƒ ÙƒØªÙŠØ±."
    ];

    const jokes = [
      "Ù„Ùˆ ÙÙŠÙ‡ Ø¬Ø§Ø¦Ø²Ø© Ù„Ø£ÙƒØªØ± Ø¯Ù…Ø§Øº Ù…Ø¹Ù‚Ø¯Ø©â€¦ ÙÙ€ Ø£Ù†Øª Ø£ÙˆÙ„ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† ğŸ˜‚",
      "Ø§Ù„Ø¬ÙŠÙ… Ø¯Ù‡ Ø®Ù„Ø§Ù†ÙŠ Ø£Ø±Ø§Ø¬Ø¹ Ù†ÙØ³Ù‰ Ø¨ØµØ±Ø§Ø­Ø© ğŸ˜µ",
      "Ø­Ø§Ø³Ø³ Ø¥Ù†Ùƒ ÙƒÙ†Øª Ø¨ØªÙ„Ø¹Ø¨ ÙˆØ¥Ù†Øª Ø¨ØªØºÙ†ÙŠØŸ ğŸ¤",
      "Ù…Ø§Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ Ø¥Ø¨Ø¯Ø§Ø¹Ùƒâ€¦ ÙƒÙ…Ù„Øª Ù…Ø³Ø­ ÙˆØ£Ù†Ø§ Ù†Ø§ÙŠÙ…Ø© ğŸ’¤",
      "Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø³Ù„Ø³Ù„ Ø¹Ù† Ø§Ù„Ø¬ÙŠÙ… Ø¯Ù‡â€¦ ÙƒÙ†Øª Ù‡Ø³Ù…ÙŠÙ‡: (Ø§Ù„Ù„Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ©).",
      "Ø¹Ù‚Ù„Ùƒ Ø¨ÙŠØ´ØªØºÙ„ Ø¨Ù†Ø¸Ø§Ù… ÙˆÙŠÙ†Ø¯ÙˆØ² 98ØŸ ÙˆÙ„Ø§ Ø¥ÙŠÙ‡ØŸ ğŸ˜…",
      "Ø¥Ù†Øª Ø¨ØªÙ„Ø¹Ø¨ ÙˆÙ„Ø§ Ø¨ØªÙƒØªØ¨ Ø´Ø¹Ø±ØŸ ÙƒÙ„ Ø­Ø±ÙƒØ© ÙÙŠÙ‡Ø§ Ø¯Ø±Ø§Ù…Ø§!",
      "Ø£Ù†Ø§ Ø¨Ø¯Ø£Øª Ø£Ù‚Ù„Ù‚ Ù…Ù† Ø°ÙƒØ§Ø¦Ùƒ Ø§Ù„ØµØ§Ù…Øª Ø¯Ù‡ ğŸ˜³",
      "Ù„Ùˆ ÙÙŠ Ù…Ø¯Ø±Ø³Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠâ€¦ ØªØ¨Ù‚Ù‰ Ø£Ù†Øª Ø§Ù„Ù…Ø¯Ø±Ù‘Ø³.",
      "Ø£Ù†Øª Ù…Ø²ÙŠØ¬ ØºØ±ÙŠØ¨ Ø¨ÙŠÙ† Ø¹Ø¨Ù‚Ø±ÙŠØ© ÙˆØ¨Ù‡Ù„ÙˆØ§Ù† ğŸ¤¹"
    ];
    message = `${rand(opening)}\n\n${rand(emotion)}\n${rand(risk)}\n${rand(personality)}\n\n${rand(closing)}\n\nğŸ¥š ${rand(jokes)}`;
  } else {
    const opening = [
      "ğŸ“˜ Quick insight based on your last round...",
      "ğŸ§  The Egg has been observing you, here's what it found...",
      "ğŸ­ Every move tells a story. Here's yours...",
      "ğŸ‘ï¸ Let me tell you what kind of player you were this time.",
      "ğŸ¤– Your last round said a lot... and I took notes.",
      "ğŸ“Š Here's the result of what the Egg saw.",
      "ğŸ§© You revealed more than you think. Let's analyze it.",
      "ğŸ•µï¸â€â™‚ï¸ No escape... this round was rich with signs.",
      "ğŸ® Short analysis, big discoveries.",
      "ğŸ’¡ Ready for some honest truth?"
    ];

    const emotion = b.fastMoves > b.slowMoves ? [
      "You moved like something was chasing you ğŸ˜…",
      "You seemed to react without thinking much â€” spontaneous or anxious?",
      "Fast decisions, quick moves â€” are you always this hyped?",
      "Your speed says urgency. Excited or overwhelmed?",
      "You acted before thinking â€” bold or just impulsive?",
      "Rushing through moves... trying to escape your own thoughts maybe?",
      "High speed detected â€” confidence or hidden panic?",
      "You played like there was a bomb timer ğŸ˜†",
      "That looked fast... but were you sure or just winging it?",
      "You're faster than me typing this report ğŸ˜³"
    ] : [
      "Your calm approach was noticeable â€” smart or too slow?",
      "You thought through everythingâ€¦ maybe too much.",
      "Every move was calculated â€” are you always this careful?",
      "Slow and steadyâ€¦ but did you miss some chances?",
      "That kind of focus can be a strengthâ€¦ or a trap.",
      "Your brain was clearly ahead of your fingers.",
      "Deep thinking detectedâ€¦ but donâ€™t overdo it.",
      "You moved like you were meditatingâ€¦ zen mode on ğŸ§˜",
      "Your moves felt like solving a puzzle piece by piece.",
      "Methodical, precise â€” impressive or hesitant?"
    ];

    const risk = b.nearFails >= 3 ? [
      "You almost lost it â€” multiple times. Drama much? ğŸ˜…",
      "High tension, high stakes. You love chaos, huh?",
      "You walked the edge like it was a runway.",
      "Near-deaths everywhereâ€¦ but you survived. Barely.",
      "You like dangerâ€¦ or it likes you.",
      "Always last second saves â€” are you lucky or a magician?",
      "Surviving close callsâ€¦ kind of your thing?",
      "Youâ€™re flirting with failure like itâ€™s a game ğŸ˜¬",
      "A thrill-seeker in disguise? This round says yes.",
      "The Egg saw your nerves. Respect... and concern."
    ] : [
      "Solid performance â€” barely a threat in sight.",
      "You stayed cool under pressure. Veteran style.",
      "Nothing shook youâ€¦ that's discipline.",
      "You made it look easy â€” no panic at all.",
      "Everything felt controlledâ€¦ were you even trying?",
      "Your moves were stable and focused.",
      "Smooth, composed â€” textbook play.",
      "You owned that round. Quiet power vibes.",
      "This round? You drove it like a pro.",
      "No signs of collapseâ€¦ that's rare and strong."
    ];

    const personality = b.perfectClears >= 3 ? [
      "You had some genius momentsâ€¦ flashes of brilliance.",
      "Perfect clears donâ€™t lie â€” thereâ€™s skill in that brain.",
      "You know how to strike at the right moment.",
      "You're not just playing â€” you're calculating.",
      "That wasnâ€™t luck. That was awareness and timing.",
      "You see patterns others miss. Thatâ€™s talent.",
      "Precision like that is rare â€” well done.",
      "Your instincts are solid and sharp.",
      "You played like someone whoâ€™s been here before.",
      "Brains over brute force â€” confirmed."
    ] : [
      "There was chaos in your choices. Honest.",
      "You experimented a lotâ€¦ maybe too much.",
      "Lack of combos this time â€” distracted?",
      "You were reacting more than planning.",
      "This wasnâ€™t your most focused round.",
      "Your logic wandered off a few times.",
      "Messy play. Maybe you needed coffee? â˜•",
      "Effort was there, but execution fell apart.",
      "You aimed for impact but hit confusion.",
      "Great energy, but lacking a strategy."
    ];

    const closing = [
      "Thatâ€™s just your mindset in this round â€” next time might shock me more.",
      "The Egg is watchingâ€¦ and learning.",
      "Every round peels a new layer of you.",
      "Youâ€™re evolving, and Iâ€™m recording everything ğŸ‘€",
      "Your mood changed mid-gameâ€¦ I saw that.",
      "Letâ€™s see how your next round feelsâ€¦ Iâ€™ll be back.",
      "Youâ€™re unpredictable â€” I love that.",
      "Iâ€™m not judging. Justâ€¦ observingâ€¦ deeply.",
      "Youâ€™ve got style. Messy or not, itâ€™s yours.",
      "This isnâ€™t over. Itâ€™s just the beginning."
    ];

    const jokes = [
      "I need therapy after reading your gameplay ğŸ˜…",
      "That round was a rollercoaster â€” and I wasnâ€™t strapped in!",
      "You play like you're texting and skydiving. At the same time.",
      "Your brain is either a geniusâ€¦ or a prankster.",
      "Your round felt like a jazz solo. Beautiful chaos ğŸ·",
      "Do you even know what youâ€™re doing? Because I donâ€™t ğŸ˜µ",
      "You stress me out, and Iâ€™m a robot!",
      "Keep goingâ€¦ just warn me next time ğŸ˜¬",
      "If confusion was a skill, youâ€™d be ranked #1 ğŸ†",
      "I laughed. I cried. I questioned reality. Thanks."
    ];

    message = `${rand(opening)}\n\n${rand(emotion)}\n${rand(risk)}\n${rand(personality)}\n\n${rand(closing)}\n\nğŸ¥š ${rand(jokes)}`;
  }

  textArea.textContent = "";
  dots.style.display = "flex";
  avatar.src = "assets/ai_thinking.png";

  setTimeout(() => {
    dots.style.display = "none";
    let i = 0;
    function typeChar() {
      if (i < message.length) {
        textArea.textContent += message[i++];
        setTimeout(typeChar, 35);
      } else {
        shareBtn.classList.remove("hidden");
        closeBtn.classList.remove("hidden");
        avatar.src = "assets/ai_smile.png";
        avatar.classList.add("bounce");
      }
    }
    typeChar();
  }, 1000);
}


function showInsightReport() {
  showRewardedAdWithCallback(() => {
    document.getElementById("gameover").classList.remove("active");
    document.getElementById("insightScreen").classList.remove("hidden");
    generateInsightReport();
  });
}


    function showAIMessage(text) {
      const aiText = document.getElementById("aiText");
      const heatBar = document.getElementById("aiHeatBar");
      aiText.textContent = text;
      aiText.classList.remove("show");
      heatBar.classList.remove("active");
      void aiText.offsetWidth;
      void heatBar.offsetWidth;
      aiText.classList.add("show");
      heatBar.classList.add("active");

      setTimeout(() => {
        aiText.classList.remove("show");
        heatBar.classList.remove("active");
      }, 3500);
    }

    function clearRandomLine() {
      const isRow = Math.random() < 0.5;
      const index = Math.floor(Math.random() * 8);
      if (isRow) {
        for (let col = 0; col < 8; col++) {
          gridCells[xyToIndex(col, index)].classList.remove("filled");
        }
      } else {
        for (let row = 0; row < 8; row++) {
          gridCells[xyToIndex(index, row)].classList.remove("filled");
        }
      }
    }

    function startMonitor() {
      clearInterval(monitorInterval);
      monitorInterval = setInterval(() => {
        const activeShapes = Array.from(shapesDiv.children).map(el => JSON.parse(el.dataset.shape || "[]"));
        const playable = activeShapes.some(shape => canShapeFitAnywhere(shape));
        if (!playable) {
          clearInterval(monitorInterval);
          showGameOver();
        
          if (Math.random() < 0.07 && aiInternalNotes.length > 0) {
            const secret = aiInternalNotes[Math.floor(Math.random() * aiInternalNotes.length)];
            showAIMessage(`ğŸ¤– (Ù…Ù„Ø§Ø­Ø¸Ø© Ø°ÙƒÙŠØ©): ${secret}`);
          }
        }
      }, 300);
    }

    function clearPreview() {
      gridCells.forEach(cell => {
        cell.classList.remove("preview");
        cell.classList.remove("line-clear-preview");
      });
    }

    function showPreview(shape, x, y) {
      clearPreview();
      const previewIndexes = [];

      shape.forEach(([dx, dy]) => {
        const gx = x + dx;
        const gy = y + dy;
        if (gx >= 0 && gx < 8 && gy >= 0 && gy < 8) {
          const index = xyToIndex(gx, gy);
          previewIndexes.push(index);
          gridCells[index].classList.add("preview");
        }
      });

      for (let row = 0; row < 8; row++) {
        if ([...Array(8)].every((_, col) => {
          const i = xyToIndex(col, row);
          return gridCells[i].classList.contains("filled") || previewIndexes.includes(i);
        })) {
          for (let col = 0; col < 8; col++) {
            gridCells[xyToIndex(col, row)].classList.add("line-clear-preview");
          }
        }
      }

      for (let col = 0; col < 8; col++) {
        if ([...Array(8)].every((_, row) => {
          const i = xyToIndex(col, row);
          return gridCells[i].classList.contains("filled") || previewIndexes.includes(i);
        })) {
          for (let row = 0; row < 8; row++) {
            gridCells[xyToIndex(col, row)].classList.add("line-clear-preview");
          }
        }
      }
    }

    window.addEventListener("pointermove", e => {
      if (floating) {
        const cellSize = gridCells[0].getBoundingClientRect().width;
        const moveX = (e.pageX - pointerStartX) * 1.3;
        const moveY = (e.pageY - pointerStartY) * 1.3;

        floating.style.left = (floatingStartX + moveX - offset.x) + "px";
        floating.style.top = (floatingStartY + moveY - offset.y) + "px";

        const rect = grid.getBoundingClientRect();
        const floatRect = floating.getBoundingClientRect();
        const gridX = Math.round((floatRect.left - rect.left) / (rect.width / 8));
        const gridY = Math.round((floatRect.top - rect.top) / (rect.height / 8));

        if (canPlace(currentShape, gridX, gridY)) {
          showPreview(currentShape, gridX, gridY);
        } else {
          clearPreview();
        }
      }
    });

    window.addEventListener("pointerup", e => {
      if (!floating || !currentShape) return;
      const rect = grid.getBoundingClientRect();
      const floatRect = floating.getBoundingClientRect();
      const gridX = Math.round((floatRect.left - rect.left) / (rect.width / 8));
      const gridY = Math.round((floatRect.top - rect.top) / (rect.height / 8));

      if (canPlace(currentShape, gridX, gridY)) {
        placeShape(currentShape, gridX, gridY);
        sourceElement.remove();
      } else {
        sourceElement.style.visibility = "visible";
      }

      floating.remove();
      floating = null;
      currentShape = null;
      sourceElement = null;
      clearPreview();
    });

    let playerData = {
      language: '',
      gender: '',
      age: ''
    };

    function chooseLanguage(lang) {
  playerData.language = lang;
  localStorage.setItem("blockPlayerData", JSON.stringify(playerData));
  document.getElementById("langButtons").style.display = "none";
  document.getElementById("step2").style.display = "block";

  if(lang === 'en') {
    document.getElementById("welcomeText").innerText = "ğŸ¤– Hello! Let me know you better!";
    document.getElementById("genderText").innerText = "ğŸ‘¤ Are you a boy or a girl?";
    document.querySelectorAll("#step2 button")[0].innerText = "ğŸš¹ Boy";
    document.querySelectorAll("#step2 button")[1].innerText = "ğŸšº Girl";

    document.getElementById("ageText").innerText = "ğŸ‚ How old are you?";
    document.querySelectorAll("#step3 button")[0].innerText = "ğŸ”¢ Under 18";
    document.querySelectorAll("#step3 button")[1].innerText = "ğŸ”¢ Above 18";

    document.querySelector("#finalStep button").innerText = "ğŸš€ Let's Start The Journey!";
  } else {
    document.getElementById("welcomeText").innerText = "ğŸ¤– Ø£Ù‡Ù„Ø§Ù‹! Ø®Ù„ÙŠÙ†Ø§ Ù†ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙƒ Ø´ÙˆÙŠØ©!";
    document.getElementById("genderText").innerText = "ğŸ‘¤ Ø¥Ù†Øª ÙˆÙ„Ø¯ ÙˆÙ„Ø§ Ø¨Ù†ØªØŸ";
    document.querySelectorAll("#step2 button")[0].innerText = "ğŸš¹ ÙˆÙ„Ø¯";
    document.querySelectorAll("#step2 button")[1].innerText = "ğŸšº Ø¨Ù†Øª";

    document.getElementById("ageText").innerText = "ğŸ‚ Ø¹Ù…Ø±Ùƒ Ø£Ù‚Ù„ Ù…Ù† 18 ÙˆÙ„Ø§ Ø£ÙƒØªØ±ØŸ";
    document.querySelectorAll("#step3 button")[0].innerText = "ğŸ”¢ Ø£Ù‚Ù„ Ù…Ù† 18";
    document.querySelectorAll("#step3 button")[1].innerText = "ğŸ”¢ Ø£ÙƒØ¨Ø± Ù…Ù† 18";

    document.querySelector("#finalStep button").innerText = "ğŸš€ ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©!";
  }

  applyLanguage(); // â† Ø³Ø·Ø± Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† ØªØ±Ø¬Ù…Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  sounds.click.currentTime = 0;
sounds.click.play();

}


    function chooseGender(gender) {
      playerData.gender = gender;
      localStorage.setItem("blockPlayerData", JSON.stringify(playerData));
      document.getElementById("step2").style.display = "none";
      document.getElementById("step3").style.display = "block";
    }

    function chooseAge(age) {
  playerData.age = age;
  localStorage.setItem("blockPlayerData", JSON.stringify(playerData));

  // ğŸ‘‡ Ø¨Ø¯Ù„ Ù…Ø§ ÙŠØ¸Ù‡Ø± Ø§Ù„Ø²Ø±Ø§Ø±ØŒ Ù†Ø´ØºÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
  // document.getElementById("step3").style.display = "none";
  // document.getElementById("finalStep").style.display = "block";

  finishWelcome(); // â† ÙƒØ¯Ù‡ Ù†Ù†ØªÙ‚Ù„ ÙÙˆØ±Ù‹Ø§ Ø¥Ù„Ù‰ Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØ§Ø±
}


    function finishWelcome() {
  localStorage.setItem("blockPlayerData", JSON.stringify(playerData));
  reloadAIResponses();

  function startAvatarIntroduction() {
  const aiText = document.getElementById("introAiText");
  const aiDots = document.querySelector("#avatarIntroScreen .ai-dots");
  const avatarImg = document.getElementById("introAiAvatar");
  
  const savedData = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
  const lang = savedData.language || "ar";
  const gender = savedData.gender || "male";
  
  let message = "";

  if (lang === "ar") {
    if (gender === "male") {
      message = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ!\nØ£Ù†Ø§ Ø¨ÙŠØ¶Ø© Ø§Ù„Ø¨Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ø§Ù„Ù…Ø²Ø±Ù‚Ø´Ø©... Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¹Ù„Ù‰ Ù…Ø²Ø§Ø¬ÙŠ ÙØ§Ø®Ø± Ù…Ù† Ø§Ù„Ø¢Ø®Ø±.\nÙ…Ù‡Ù…ØªÙŠ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©: Ø£Ø®Ù„ÙŠÙƒ ØªØ·ÙØ´ ÙˆØªÙ…Ø³Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø©!";
    } else {
      message = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒÙŠ!\nØ£Ù†Ø§ Ø¨ÙŠØ¶Ø© Ø§Ù„Ø¨Ø·Ø±ÙŠÙ‚ Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ Ø§Ù„Ù…Ø²Ø±Ù‚Ø´Ø©... Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¹Ù„Ù‰ Ù…Ø²Ø§Ø¬ÙŠ ÙØ§Ø®Ø± Ù…Ù† Ø§Ù„Ø¢Ø®Ø±.\nÙ…Ù‡Ù…ØªÙŠ Ø§Ù„Ù„Ø°ÙŠØ°Ø©: Ø£Ø®Ù„ÙŠÙƒÙŠ ØªØ²Ù‡Ù‚ÙŠ ÙˆØªÙ…Ø³Ø­ÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©!";
    }
  } else if (lang === "en") {
    if (gender === "male") {
      message = "Hey there!\nI'm the Blue Penguin Egg... a sarcastic piece of AI made just to mess with you.\nMy simple mission: Make you rage quit and delete the game!";
    } else {
      message = "Hey girl!\nI'm the Blue Penguin Egg... a sarcastic piece of AI crafted just to drive you crazy.\nMy sweet mission: Make you rage quit and uninstall the game!";
    }
  }

  aiText.textContent = "";
  aiDots.style.display = "flex"; 

  setTimeout(() => {
    aiDots.style.display = "none"; 

    let charIndex = 0;
    function typeNextChar() {
      if (charIndex < message.length) {
        aiText.textContent += message[charIndex];
        charIndex++;
        setTimeout(typeNextChar, 40); // Ø³Ø±Ø¹Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©
      } else {
        
        setTimeout(() => {
  avatarImg.src = "assets/ai_angry.png";
  avatarImg.classList.add("shake");

  // ğŸ‘‡ Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø±Ø§Ø± "ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©"
  const startBtn = document.createElement("button");
  startBtn.innerText = lang === "ar" ? "ğŸ® ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©!" : "ğŸ® Let's Start!";
  startBtn.className = "welcome-btn";
  startBtn.style.marginTop = "25px";
  startBtn.onclick = () => {
    document.getElementById("avatarIntroScreen").classList.add("hidden");
    switchScreen("menu");
  };

  document.getElementById("avatarWrapper").appendChild(startBtn);
}, 2000);

      }
    }

    typeNextChar();
  }, 1200);
}



  // â— Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù„Ø·ÙŠÙØ©
  document.getElementById("welcomeScreen").innerHTML = `
    <div class="welcome-card">
      <p id="loadingText">ğŸ¤– Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù…ØºØ§Ù…Ø±ØªÙƒ...</p>
      <div id="loadingAvatar" style="margin-top:20px;">
        <div class="bubble-inner">
          <img id="aiAvatarLoading" src="assets/ai_thinking.png" alt="AI" />
          <div class="ai-dots">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>
    </div>
  `;

  // Ù†Ø¨Ø¯Ø£ ÙØ­Øµ Ø§Ù„ØªØ­Ù…ÙŠÙ„
  const checkReady = setInterval(() => {
    if (window.aiReady) {
      clearInterval(checkReady);
      document.getElementById("welcomeScreen").style.display = "none";
document.getElementById("avatarIntroScreen").classList.remove("hidden");
startAvatarIntroduction();

    }
  }, 100);
}





    function showPlayerStats() {
      soundEffects.play('buttonClick');
      let savedData = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
      let lang = savedData.language || 'ar';
      let t = applyLanguageText(lang);
      
      let highestScore = localStorage.getItem("blockHighestScore") || 0;
      let lastScore = localStorage.getItem("blockLastScore") || 0;
      let playCount = localStorage.getItem("blockPlayCount") || 0;

      let statsHTML = `
        ${t.genderLabel}: ${savedData.gender === 'male' ? (lang === 'ar' ? 'ÙˆÙ„Ø¯' : 'Boy') : (lang === 'ar' ? 'Ø¨Ù†Øª' : 'Girl')} 
        <button class="btn" style="padding:5px 10px; font-size:0.9rem;" onclick="changeGender()">${t.change}</button><br>

        ${t.ageLabel}: ${savedData.age === 'under18' ? (lang === 'ar' ? 'Ø£Ù‚Ù„ Ù…Ù† 18' : 'Under 18') : (lang === 'ar' ? 'Ø£ÙƒØ¨Ø± Ù…Ù† 18' : 'Above 18')}
        <button class="btn" style="padding:5px 10px; font-size:0.9rem;" onclick="changeAge()">${t.change}</button><br>

        ${t.langLabel}: ${lang === 'ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English'}
        <button class="btn" style="padding:5px 10px; font-size:0.9rem;" onclick="changeLanguage()">${t.change}</button><br>

        ${t.highScore}: ${highestScore}<br>
        ${t.lastScore}: ${lastScore}<br>
        ${t.playCount}: ${playCount}<br>
        ${gameTranslations[lang].levelMessage}
      `;

      document.getElementById("statsContent").innerHTML = statsHTML;
      document.getElementById("playerStats").style.display = "flex";
    }

    function changeGender() {
  let data = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
  data.gender = (data.gender === 'male') ? 'female' : 'male';
  localStorage.setItem("blockPlayerData", JSON.stringify(data));
  reloadAIResponses(); // ğŸ‘ˆ ØªØ¶ÙŠÙ Ø¯ÙŠ
  showPlayerStats();
}

function changeAge() {
  let data = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
  data.age = (data.age === 'under18') ? 'above18' : 'under18';
  localStorage.setItem("blockPlayerData", JSON.stringify(data));
  reloadAIResponses(); // ğŸ‘ˆ ØªØ¶ÙŠÙ Ø¯ÙŠ
  showPlayerStats();
}

function changeLanguage() {
  let data = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
  data.language = (data.language === 'ar') ? 'en' : 'ar';
  localStorage.setItem("blockPlayerData", JSON.stringify(data));
  reloadAIResponses(); // ğŸ‘ˆ ØªØ¶ÙŠÙ Ø¯ÙŠ
  showPlayerStats();
  applyLanguage();
}


    function closeStats() {
      if (window.soundEffects) soundEffects.play('button');
      document.getElementById("playerStats").style.display = "none";
    }

    function getAIPersonalMessage(score) {
      const lang = JSON.parse(localStorage.getItem("blockPlayerData"))?.language || 'ar';
      
      if(score < 100) return lang === 'ar' ? "Ù„Ø³Ù‡ Ø¨ØªØ¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©! ğŸš€" : "Just starting! ğŸš€";
      if(score < 500) return lang === 'ar' ? "Ø£Ø¯Ø§Ø¡ Ø¬Ù…ÙŠÙ„! ğŸ’ª Ø§Ø³ØªÙ…Ø±." : "Good performance! ğŸ’ª Keep going.";
      if(score < 1000) return lang === 'ar' ? "Ø¥Ù†Øª Ù…Ø­ØªØ±Ù! ğŸ”¥" : "You're a pro! ğŸ”¥";
      return gameTranslations[lang].levelMessage;
    }

    function applyLanguage() {
      const saved = JSON.parse(localStorage.getItem("blockPlayerData")) || {};
      const lang = saved.language || "ar";
      const t = gameTranslations[lang];

      document.querySelector(".game-title").textContent = "Block Puzzle AI";
      document.querySelector(".start-btn").textContent = t.startBtn;
      document.querySelector(".stats-btn").textContent = t.statsBtn;
      document.getElementById("shareInsightBtn").textContent = lang === "ar"
  ? "ğŸ”— Ø´Ø§Ø±Ùƒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ø¹ ØµØ­Ø§Ø¨Ùƒ"
  : "ğŸ”— Share Insight";

document.getElementById("closeInsightBtn").textContent = lang === "ar"
  ? "ğŸ ÙƒÙØ§ÙŠØ© ØªØ­Ù„ÙŠÙ„.. Ù†Ø±Ø¬Ø¹ØŸ"
  : "ğŸ Enough insight.. go back?";

      document.getElementById("insightBtn").textContent = lang === "ar"
  ? "ğŸ“˜ ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„ØªÙƒ Ø§Ù„Ù†ÙØ³ÙŠØ©"
  : "ğŸ“˜ AI Insight Report";

      document.getElementById("scoreboard").textContent = t.scoreText + score;
      document.querySelector("#gameover h1").textContent = t.gameOver;
      document.getElementById("resumeBtn").textContent = t.resumeBtn;
      document.getElementById("restartBtn").textContent = t.restartBtn;
      document.getElementById("countdown").textContent = t.countdownText;
      document.getElementById("statsText").textContent = t.statsTitle;
      document.getElementById("backBtn").textContent = t.backBtn;

      if (document.getElementById("welcomeScreen").style.display !== "none") {
        chooseLanguage(lang);
      }
    }

    function shareInsight() {
  const report = document.getElementById("insightAiText").textContent;
  if (navigator.share) {
    navigator.share({
      title: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¶Ø© ğŸ§ ",
      text: report,
    }).then(() => {
      console.log("âœ… ØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„");
    }).catch(err => {
      alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: " + err);
    });
  } else {
    alert("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.");
  }
}


function closeInsight() {
  document.getElementById("insightScreen").classList.add("hidden");
  switchScreen("menu");
}




    function applyLanguageText(lang) {
      return {
        genderLabel: lang === 'ar' ? "ğŸ‘¤ Ø§Ù„Ù†ÙˆØ¹" : "ğŸ‘¤ Gender",
        ageLabel: lang === 'ar' ? "ğŸ‚ Ø§Ù„Ø³Ù†" : "ğŸ‚ Age",
        langLabel: lang === 'ar' ? "ğŸŒ Ø§Ù„Ù„ØºØ©" : "ğŸŒ Language",
        highScore: lang === 'ar' ? "ğŸ† Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©" : "ğŸ† High Score",
        lastScore: lang === 'ar' ? "ğŸ¯ Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø©" : "ğŸ¯ Last Score",
        playCount: lang === 'ar' ? "ğŸ”¥ Ù…Ø±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨" : "ğŸ”¥ Play Count",
        aiMessage: lang === 'ar' ? "ğŸ’¡ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ" : "ğŸ’¡ Smart Assistant",
        change: lang === 'ar' ? "ØªØºÙŠÙŠØ±" : "Change"
      };
    }

    let idleTimer, idleRepeater;
    function resetIdleTimer() {
      clearTimeout(idleTimer);
      clearInterval(idleRepeater);

      idleTimer = setTimeout(() => {
        showAIReaction("idle");
        idleRepeater = setInterval(() => {
          showAIReaction("idle");
        }, 15000);
      }, 12000);
    }

    ["pointerdown", "pointermove", "keydown"].forEach(evt =>
      window.addEventListener(evt, resetIdleTimer)
    );
    resetIdleTimer();

    function backToMenu() {
      soundEffects.play('buttonClick');
      clearInterval(monitorInterval);
      switchScreen("menu");
    }
    let countdownTimer;
let countdownSeconds = 5;

function startResumeCountdown() {
  countdownSeconds = 5;
  countdownEl.textContent = `Or wait ${countdownSeconds} seconds...`;
  countdownEl.classList.add("countdown-animate");

  countdownTimer = setInterval(() => {
    countdownSeconds--;
    countdownEl.textContent = `Or wait ${countdownSeconds} seconds...`;

    if (countdownSeconds <= 0) {
      clearInterval(countdownTimer);

      // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù‡Ù„Ø© Ø¨Ø¯ÙˆÙ† Ø¶ØºØ·
      resumeBtn.style.display = "none";
      countdownEl.style.display = "none";
      

      finalScoreDisplay.textContent = `Score: ${score}`;
      finalScoreDisplay.classList.add("show", "bounce-in");
      restartBtn.style.display = "inline-block";
    }
  }, 1000);
}



    function getRandomAIResponse(eventType) {
  if (typeof aiResponses !== "undefined" && aiResponses[eventType] && aiResponses[eventType].length > 0) {
    const responses = aiResponses[eventType];
    const randomIndex = Math.floor(Math.random() * responses.length);
    console.log("ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…Ù„Ø©:", responses[randomIndex]);
    return responses[randomIndex];
  }
  console.log("Ù…ÙÙŠØ´ Ø¬Ù…Ù„ Ù…ØªØ§Ø­Ø© Ù„Ù„Ø­Ø¯Ø«:", eventType);
  return "";
}


function showReactionMessage(message) {
  soundEffects.play('bubbleAppear'); // <-- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
  const aiBubble = document.getElementById("aiBubble");
  const aiBoard = document.getElementById("aiBoard");
  const aiText = document.getElementById("aiText");
  const heatBar = document.getElementById("aiHeatBar");
  const aiDots = document.querySelector(".ai-dots");

  aiText.textContent = "";
  aiDots.style.display = "flex"; // Ø§Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù‚Ø· Ø§Ù„Ù„ÙŠ Ø¨ØªØªØ­Ø±Ùƒ

  aiBubble.classList.remove("hidden");
  aiBoard.classList.remove("hidden");
  aiBubble.classList.add("show");
  aiBoard.classList.add("show");
  aiText.classList.remove("hidden");
  aiText.classList.add("show");

  // Reset and animate the heat bar
  heatBar.style.width = "100%";
  heatBar.style.transition = "none";
  void heatBar.offsetWidth;
  heatBar.style.transition = "width 3s linear";
  heatBar.style.width = "0%";

  // Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø§Ù„ØªÙÙƒÙŠØ±ØŒ ÙŠØ¨Ø¯Ø£ ÙŠÙƒØªØ¨ Ø§Ù„Ø¬Ù…Ù„Ø©
  setTimeout(() => {
    aiDots.style.display = "none"; // Ø§Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù‚Ø·
    let charIndex = 0;
    function typeNextChar() {
      if (charIndex < message.length) {
        aiText.textContent += message[charIndex];
        charIndex++;
        setTimeout(typeNextChar, 40); // Ø³Ø±Ø¹Ø© Ø§Ù„Ø­Ø±Ù
      }
    }
    typeNextChar();
  }, 1000); // ÙˆÙ‚Øª Ø§Ù„ØªÙÙƒÙŠØ± Ù‚Ø¨Ù„ ÙŠØ¨Ø¯Ø£ ÙŠÙƒØªØ¨

  // Hide after 3.5 seconds
  setTimeout(() => {
    aiBubble.classList.add("hide");
    aiBoard.classList.add("hide");
    aiText.classList.remove("show");

    setTimeout(() => {
      aiBubble.classList.remove("show", "hide");
      aiBoard.classList.remove("show", "hide");
      aiBubble.classList.add("hidden");
      aiBoard.classList.add("hidden");
      aiText.classList.add("hidden");

      processMessageQueue();
    }, 500);
  }, 3500);
}




function startAvatarBlink() {
  const avatarImg = document.getElementById("aiAvatar");
  setInterval(() => {
    avatarImg.classList.add("blink");
    setTimeout(() => {
      avatarImg.classList.remove("blink");
    }, 200); // Ù…Ø¯Ø© Ø§Ù„Ø±Ù…Ø´
  }, 4000); // ÙƒÙ„ 4 Ø«ÙˆØ§Ù†ÙŠ Ø±Ù…Ø´Ø©
}

startAvatarBlink();
window.allAIResponses = {}; // Ù…ÙƒØ§Ù† ØªØ®Ø²ÙŠÙ† ÙƒÙ„ Ø§Ù„Ø¬Ù…Ù„

function loadAllAIResponses(callback) {
  const configs = [
    'ar_male_under18', 'ar_male_above18', 'ar_female_under18', 'ar_female_above18',
    'en_male_under18', 'en_male_above18', 'en_female_under18', 'en_female_above18'
  ];

  let loadedCount = 0;

  configs.forEach(config => {
    const script = document.createElement('script');
    script.src = `ai_responses/aiResponses_${config}.js`;
    script.onload = function() {
      console.log(`âœ… Ù…Ù„Ù aiResponses_${config} Ø§ØªØ­Ù…Ù„`);
      window.allAIResponses[config] = window.tempAIResponses;
      loadedCount++;
      if (loadedCount === configs.length) {
        console.log("âœ…âœ…âœ… ÙƒÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ù…Ù„ Ø§ØªØ­Ù…Ù„Øª Ø¨Ù†Ø¬Ø§Ø­!");
        callback(); // Ù„Ù…Ø§ ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª ØªØªØ­Ù…Ù„ Ø´ØºÙ„ Ø§Ù„ÙƒÙˆÙ„Ø¨Ø§Ùƒ
      }
    };
    document.body.appendChild(script);
  });
}

window.onload = () => {
  loadAllAIResponses(() => {
    reloadAIResponses();
    let savedData = JSON.parse(localStorage.getItem("blockPlayerData"));
    if (savedData && savedData.language) {
      document.getElementById("welcomeScreen").style.display = "none";
      applyLanguage();
    }
  });
}



  </script>
</body>
</html>